<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVAIL — Opportunity Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Primary brand blue */
            --blue:#4a6fa5; --blue-lt:#eef2f8; --blue-dk:#2d4f82;

            /* Aliases for JS backward compat */
            --teal:#4a6fa5; --teal-light:#eef2f8;
            --accent:#4a6fa5; --accent-hover:#2d4f82; --accent-light:#eef2f8;
            --focus:#4a6fa5;

            /* Sidebar / Navy (used for sidebar bg) */
            --navy-900:#4a6fa5; --navy-800:#3d6292; --navy-700:#365880;
            --navy-600:#2d4f82; --navy-nav-text:rgba(255,255,255,.75); --navy-nav-active:#ffffff;

            /* Semantic colors */
            --green:#0fa67f; --green-light:#e8f8f3;
            --amber:#d9880b; --amber-light:#fef5e6;
            --red:#d94452; --red-light:#fce8ea;
            --purple:#5b21b6; --purple-lt:#ede9fe;

            /* Surfaces */
            --bg:#f2f3f6; --white:#fff; --surface:#f7f8fa; --input:#f0f2f5;
            --card2:#eceef2; --bg2:#ebeef3; --bg3:#d1d5db;

            /* Text */
            --text:#1a1f2e; --text2:#3d4a5c; --muted:#5f6d7e;

            /* Borders */
            --border:#c8cdd6; --border2:#d1d5db;

            /* Also keep --blue-light alias */
            --blue-light:#eef2f8;

            /* Shadows */
            --shadow-sm:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.03);
            --shadow-md:0 4px 12px rgba(0,0,0,.08),0 1px 3px rgba(0,0,0,.04);
            --shadow-lg:0 8px 24px rgba(0,0,0,.1),0 2px 6px rgba(0,0,0,.05);

            /* Sidebar */
            --sidebar-width:160px; --sidebar-collapsed:52px; --sbw:200px;
        }
        *{margin:0;padding:0;box-sizing:border-box}

        /* Utility classes */
        .text-xs{font-size:11px}.text-xxs{font-size:10px}
        .text-xs-muted{font-size:11px;color:var(--muted)}.text-xxs-muted{font-size:10px;color:var(--muted)}
        .text-xs-secondary{font-size:11px;color:var(--text2)}.text-muted{color:var(--muted)}
        .text-right{text-align:right}.text-center{text-align:center}
        .flex-between{display:flex;justify-content:space-between;align-items:center}
        .flex-center{display:flex;align-items:center}.flex-gap-sm{display:flex;align-items:center;gap:6px}
        .flex-gap{display:flex;align-items:center;gap:10px}.hidden{display:none}
        .clickable{cursor:pointer}.card-empty{text-align:center;padding:16px;color:var(--muted);font-size:13px}
        html,body{height:100%;overflow:hidden}
        body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);display:flex;flex-direction:column}
        h1,h2,h3,h4,h5,h6,b,strong,.vp-label,.si-contacts-title,.sight-group-title{color:var(--blue)}

        /* Login */
        .login{display:flex;align-items:center;justify-content:center;height:100vh;background:linear-gradient(160deg,#f0f4f8 0%,#dbeafe 40%,#e8f1f8 100%)}
        .login-card{background:var(--white);border:1px solid var(--border);border-radius:20px;padding:56px 48px 44px;text-align:center;max-width:460px;width:90%;box-shadow:0 8px 40px rgba(0,0,0,.07),0 1px 3px rgba(0,0,0,.04)}
        .login-logo{width:280px;margin-bottom:12px}
        .login-divider{width:48px;height:2px;background:var(--border2);margin:0 auto 20px;border-radius:1px}
        .login-card .sub{color:var(--text2);font-size:13px;font-weight:500;margin-bottom:32px;letter-spacing:-.01em}
        .btn-ms{display:inline-flex;align-items:center;gap:10px;background:var(--blue);color:#fff;text-decoration:none;padding:14px 36px;border-radius:10px;font-weight:700;font-size:14px;transition:all .2s;box-shadow:0 2px 8px rgba(74,111,165,.25)}
        .btn-ms:hover{background:var(--blue-dk);box-shadow:0 4px 16px rgba(74,111,165,.35);transform:translateY(-1px)}
        .ver{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);margin-top:28px;letter-spacing:.02em}

        /* Shell — sidebar + main content layout */
        .shell{display:flex;height:100vh;overflow:hidden}

        /* Sidebar */
        .sidebar{position:fixed;top:56px;left:0;bottom:0;width:var(--sbw);background:var(--white);border-right:1px solid var(--border);box-shadow:2px 0 12px rgba(0,0,0,.06);z-index:150;transform:translateX(-100%);transition:transform .3s ease;display:flex;flex-direction:column;overflow:hidden}
        .sidebar.collapsed{width:var(--sidebar-collapsed)}
        .logo-zone{height:58px;flex-shrink:0;cursor:pointer;border-bottom:1px solid rgba(255,255,255,.14);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
        .logo-avail{position:absolute;display:flex;justify-content:center;align-items:center;width:100%;padding:0 14px;transition:opacity .18s,transform .18s}
        .logo-avail img{width:120px;max-height:40px;object-fit:contain;filter:brightness(0) invert(1);display:block}
        .logo-trio{position:absolute;opacity:0;transform:scale(.82);transition:opacity .18s,transform .18s}
        .logo-trio img{width:38px;height:32px;object-fit:cover;object-position:left center;filter:brightness(0) invert(1);display:block}
        .sidebar.collapsed .logo-avail{opacity:0;transform:scale(.85)}
        .sidebar.collapsed .logo-trio{opacity:1;transform:scale(1)}
        .sidebar-brand{font-size:14px;font-weight:800;color:var(--navy-nav-active);white-space:nowrap;overflow:hidden;margin-left:44px;transition:opacity .22s}
        .sidebar.collapsed .sidebar-brand{opacity:0;width:0}
        .sidebar-toggle{background:none;border:none;color:var(--navy-nav-text);cursor:pointer;padding:6px;border-radius:6px;font-size:14px;transition:all .22s cubic-bezier(.4,0,.2,1);display:flex;align-items:center;justify-content:center;width:32px;height:32px}
        .sidebar-toggle:hover{color:var(--navy-nav-active);background:rgba(255,255,255,.12)}
        .sidebar-toggle svg{transition:transform .22s cubic-bezier(.4,0,.2,1)}
        .sidebar.collapsed .sidebar-toggle svg{transform:rotate(180deg)}


        .sidebar-section{padding:4px 0}
        .sidebar-section-label{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:rgba(255,255,255,.35);padding:12px 14px 4px;white-space:nowrap;overflow:hidden}
        .sidebar.collapsed .sidebar-section-label{visibility:hidden;height:8px;padding:0}
        .sidebar-item{display:flex;align-items:center;gap:10px;padding:8px 14px;cursor:pointer;transition:all .15s;border-radius:6px;margin:1px 8px;font-size:13px;font-weight:500;white-space:nowrap;overflow:hidden;color:rgba(255,255,255,.75);text-decoration:none}
        .sidebar-item:hover{background:rgba(255,255,255,.1);color:#fff}
        .sidebar-item.active{background:rgba(255,255,255,.18);color:#fff;font-weight:600}
        .sidebar-item svg,.sidebar-item .si-icon{width:18px;height:18px;flex-shrink:0;opacity:.7}
        .sidebar-item.active svg,.sidebar-item.active .si-icon{opacity:1}
        .sidebar-item .si-label{overflow:hidden;text-overflow:ellipsis;transition:opacity .22s}
        .sidebar.collapsed .sidebar-item .si-label{opacity:0;width:0;overflow:hidden}
        .sidebar-item .si-badge{margin-left:auto;font-size:10px;font-weight:700;background:rgba(255,255,255,.2);color:#fff;padding:1px 6px;border-radius:8px;min-width:18px;text-align:center;flex-shrink:0}
        .sidebar.collapsed .sidebar-item .si-badge{display:none}
        .sidebar.collapsed .sidebar-item{padding:8px 0;justify-content:center;margin:1px 4px;border-radius:8px}

        .sidebar-bottom{margin-top:auto;display:flex;flex-direction:column}
        .sidebar-toggle-zone{padding:8px 10px;display:flex;justify-content:center;border-top:1px solid rgba(255,255,255,.12)}
        .sidebar-footer{border-top:1px solid var(--border);padding:10px 14px;display:flex;align-items:center;gap:8px}
        .sidebar-user{display:flex;align-items:center;gap:8px;padding:4px;font-size:12px;color:rgba(255,255,255,.75);cursor:default}
        .sidebar-user-avatar{width:28px;height:28px;border-radius:50%;background:rgba(255,255,255,.15);color:#fff;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0}
        .sidebar-user-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:500;transition:opacity .22s}
        .sidebar.collapsed .sidebar-user-name{opacity:0;width:0}
        .sidebar-footer .btn-out{background:var(--surface);border:1px solid var(--border);color:var(--text2);padding:5px 10px;border-radius:6px;cursor:pointer;font-size:11px;transition:.15s;white-space:nowrap;overflow:hidden}
        .sidebar-footer .btn-out:hover{background:var(--bg2);color:var(--text);border-color:var(--teal)}
        .sidebar.collapsed .sidebar-footer .btn-out span{display:none}
        .sidebar.collapsed .sidebar-footer .btn-out::after{content:'→'}
        .sidebar-settings-btn{background:none;border:none;color:rgba(255,255,255,.75);cursor:pointer;font-size:14px;padding:4px 6px;border-radius:4px;transition:.15s}
        .sidebar-settings-btn:hover{color:#fff;background:rgba(255,255,255,.1)}

        /* Topbar */
        .topbar{display:flex;align-items:center;gap:12px;padding:10px 16px;position:relative;z-index:100;flex-shrink:0}
        .page-title{font-size:14px;font-weight:700;color:#1f2937}
        .req-total-count{font-size:11px;color:#9ca3af}
        .topbar-right{margin-left:auto;display:flex;align-items:center;gap:10px}
        .user-name{font-size:12px;color:#6b7280}
        .user-avatar{width:28px;height:28px;border-radius:50%;background:#4a6fa5;color:white;font-size:11px;font-weight:700;display:flex;align-items:center;justify-content:center}

        /* Main content area */
        .main{flex:1;background:var(--bg);overflow:hidden;display:flex;flex-direction:column;transition:margin-left .3s}
        .main-scroll{flex:1;overflow-y:auto;padding:8px 24px}

        /* Keep legacy topbar classes for settings dropdown (reused in sidebar) */
        .user{display:flex;align-items:center;gap:8px;color:var(--text2);font-size:12px}
        .btn-out{background:var(--bg);border:1px solid var(--border);color:var(--text2);padding:4px 10px;border-radius:6px;cursor:pointer;font-size:11px;transition:.15s}
        .btn-out:hover{border-color:var(--accent);color:var(--accent)}

        /* Buttons */
        .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 18px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s ease;border:none;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}
        .btn-primary{background:var(--blue);color:#fff;box-shadow:0 1px 3px rgba(74,111,165,.25)}.btn-primary:hover{background:var(--blue-dk);box-shadow:0 3px 8px rgba(74,111,165,.3);transform:translateY(-1px)}
        .btn-success{background:var(--green);color:#fff;box-shadow:0 1px 3px rgba(15,166,127,.25)}.btn-success:hover{background:#0d9070;box-shadow:0 3px 8px rgba(15,166,127,.3);transform:translateY(-1px)}
        .btn-ghost{background:none;border:1px solid var(--border);color:var(--text2)}.btn-ghost:hover{border-color:var(--teal);color:var(--teal);background:var(--teal-light)}
        .btn-sm{padding:5px 11px;font-size:11px}
        .btn-danger{background:var(--red-light);color:var(--red);border:1px solid rgba(217,68,82,.15)}
        .btn:disabled{opacity:.4;cursor:default}

        /* Cards */
        .card{background:var(--white);border:1px solid var(--border);border-left:3px solid var(--border2);border-radius:8px;padding:14px 16px;margin-bottom:6px;transition:all .2s ease;box-shadow:var(--shadow-sm)}
        .card:hover{border-color:var(--border2);border-left-color:var(--teal);box-shadow:var(--shadow-md)}
        .card-clickable{cursor:pointer}
        .empty{color:var(--muted);font-size:13px;padding:40px 0;text-align:center}

        /* Collapsible Groups — shared component */
        .coll-group{margin-bottom:6px}
        .coll-group-header{display:flex;align-items:center;gap:8px;padding:8px 12px;cursor:pointer;user-select:none;border-radius:6px;transition:background .15s;font-size:13px}
        .coll-group-header:hover{background:var(--surface)}
        .coll-chevron{font-size:11px;color:var(--muted);width:14px;text-align:center;flex-shrink:0;transition:transform .15s}
        .coll-group-name{font-weight:700;color:var(--accent);font-size:14px}
        .coll-group-count{font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace}
        .coll-group-body{padding-left:8px}
        .coll-group.collapsed .coll-group-body{display:none}

        /* Tabs */
        .tabs{display:flex;gap:2px;margin-bottom:16px;background:var(--white);border-radius:10px;padding:3px;border:1px solid var(--border);width:fit-content;box-shadow:var(--shadow-sm)}
        .tab{padding:7px 18px;border-radius:8px;border:none;background:transparent;color:var(--muted);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s ease}
        .tab.on{background:var(--blue);color:#fff}
        .tab:not(.on):hover{color:var(--text);background:var(--bg)}
        .tc{display:none}.tc.on{display:block}

        /* Requisition List */
        .req-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .req-header h2{font-size:16px;font-weight:700}
        #reqList .card{padding:8px 14px;margin-bottom:4px}
        #reqList .req-row{margin-bottom:0}
        /* 8-column requisition grid */
        .col-headers{display:grid;grid-template-columns:180px 1fr 70px 80px 60px 90px 110px 70px;gap:0 8px;padding:4px 14px;font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.04em;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg);z-index:2}
        .req-row{display:grid;grid-template-columns:180px 1fr 70px 80px 60px 90px 110px 70px;gap:0 8px;align-items:center;padding:7px 14px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .12s;border-left:3px solid transparent;font-size:12px}
        .req-row:hover{background:var(--surface)}
        .c-id{font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .c-mpns{display:flex;flex-wrap:wrap;gap:3px;min-width:0}
        .mpn-chip{display:inline-block;padding:1px 6px;border-radius:4px;background:var(--blue-light);color:var(--blue-dk);font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:500;white-space:nowrap;max-width:120px;overflow:hidden;text-overflow:ellipsis}
        .c-qty{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text);text-align:right}
        .c-val{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text);text-align:right}
        .c-src{display:flex;flex-wrap:wrap;gap:3px}
        .src-badge{display:inline-block;padding:1px 5px;border-radius:3px;font-size:9px;font-weight:600;background:var(--bg2);color:var(--text2)}
        .c-status .status-badge{font-size:10px}
        .c-user{font-size:11px;color:var(--text2);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .c-date{font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace;white-space:nowrap}
        /* Status border-left accents */
        .s-draft{border-left-color:var(--muted)}
        .s-sourcing,.s-active{border-left-color:var(--blue)}
        .s-offers{border-left-color:var(--amber)}
        .s-quoted,.s-quoting{border-left-color:var(--green)}
        .s-archive,.s-archived,.s-won,.s-lost{border-left-color:var(--purple)}
        /* Legacy — keep for any JS that references these */
        .req-card{display:flex;justify-content:space-between;align-items:center}
        .req-name{font-weight:700;font-size:15px;color:var(--accent)}
        .req-detail-row{display:flex;align-items:center;gap:10px;margin-top:2px;flex-wrap:wrap}
        .req-activity{font-size:10px;color:var(--muted);display:inline-flex;align-items:center;gap:2px}
        .req-meta{display:flex;gap:16px;font-size:11px;color:var(--text2);font-family:'JetBrains Mono',monospace;align-items:center;font-weight:500}
        .btn-archive{padding:4px 10px;border-radius:5px;font-size:10px;font-weight:600;cursor:pointer;border:1px solid var(--border);background:var(--white);color:var(--text2);transition:.15s}
        .btn-archive:hover{border-color:var(--amber);color:var(--amber);background:#fffbe6}
        .req-archived{opacity:0.55}
        .req-archived .req-name::after{content:" (archived)";font-weight:400;font-size:11px;color:var(--amber)}
        .btn-reactivate{padding:4px 10px;border-radius:5px;font-size:10px;font-weight:600;cursor:pointer;border:1px solid var(--teal);background:var(--teal-light);color:var(--teal);transition:.15s}
        .btn-reactivate:hover{background:var(--teal);color:var(--white)}
        .req-search{background:var(--input);border:1px solid var(--border);border-radius:6px;padding:8px 12px;font-size:12px;color:var(--text);width:280px;transition:.15s}
        .req-search:focus{outline:none;border-color:var(--teal);background:var(--white);box-shadow:0 0 0 2px rgba(61,104,149,.1)}
        .req-edit-cell{cursor:pointer;position:relative}
        .req-edit-cell:hover{background:var(--bg);border-radius:4px}
        .req-edit-input{background:var(--white);border:1px solid var(--teal);border-radius:4px;padding:3px 6px;font-size:12px;font-family:'JetBrains Mono',monospace;color:var(--text);width:100%;box-sizing:border-box;outline:none;box-shadow:0 0 0 2px rgba(61,104,149,.15)}
        .req-actions{display:flex;gap:4px;align-items:center}

        /* Detail Header */
        .detail-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .detail-header h2{font-size:16px;font-weight:700}
        .back-link{color:var(--teal);font-size:12px;font-weight:600;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:4px}

        /* Table — v7 bordered card rows, sortable headers */
        .tbl{width:100%;font-size:12px;border-collapse:separate;border-spacing:0 4px}
        .tbl th{text-align:left;padding:8px 10px;color:var(--text);font-weight:800;font-size:11px;text-transform:uppercase;letter-spacing:.6px;border-bottom:2px solid var(--text2);cursor:pointer;user-select:none;transition:.15s;white-space:nowrap}
        .tbl th:hover{color:var(--teal)}
        .tbl th .sort-arrow{font-size:9px;margin-left:3px;color:var(--muted)}
        .tbl th.sorted .sort-arrow{color:var(--teal)}
        .tbl td{padding:9px 10px;background:var(--white);border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
        .tbl td:first-child{border-left:1px solid var(--border);border-radius:6px 0 0 6px}
        .tbl td:last-child{border-right:1px solid var(--border);border-radius:0 6px 6px 0}
        .tbl tbody tr:hover>td{background:var(--surface)}
        .tbl tbody tr{cursor:pointer}
        .mono{font-family:'JetBrains Mono',monospace}

        /* Inline add row */
        .add-row input{background:var(--input);border:1px solid var(--border);border-radius:5px;padding:6px 8px;font-size:12px;color:var(--text);width:100%;font-family:'JetBrains Mono',monospace}
        .add-row input:focus{outline:none;border-color:var(--teal);background:var(--white)}
        .add-row input::placeholder{font-family:'DM Sans',sans-serif;color:var(--muted);font-style:italic}

        /* Sightings */
        .sight-group{margin-bottom:10px}
        .sight-group-title{font-size:13px;font-weight:700;padding:5px 0;border-bottom:2px solid var(--border);margin-bottom:4px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;user-select:none;transition:background .15s}
        .sight-group-title:hover{background:var(--bg);border-radius:4px;padding:5px 6px;margin-left:-6px;margin-right:-6px}
        .sight-group-title .mono{font-size:11px;color:var(--muted)}
        .sg-title-left{display:flex;align-items:center;gap:6px;min-width:0}
        .sg-chevron{font-size:10px;color:var(--muted);width:12px;text-align:center;flex-shrink:0;transition:transform .15s}
        .sg-mpn{cursor:pointer;color:var(--green);font-size:14px;font-weight:700}
        .sg-mpn:hover{text-decoration:underline}
        .sg-collapsed .sight-group-title{border-bottom:1px solid var(--border);margin-bottom:0}
        .sg-body{transition:all .1s ease}
        .badge.b-selected{background:#e0f2fe;color:#0369a1;font-size:10px;padding:1px 6px;border-radius:8px}
        .badge.b-matchcount{background:#fef3c7;color:#92400e;font-size:10px;padding:1px 6px;border-radius:8px}
        .collapsed-match-hint{font-size:11px;color:var(--amber);padding:4px 0;display:flex;align-items:center;gap:4px}
        .collapsed-match-hint a{color:var(--teal);text-decoration:underline;cursor:pointer}
        .collapsed-match-hint.hidden{display:none}
        .sc{display:flex;gap:6px;align-items:center;padding:4px 10px !important;margin-bottom:3px !important;border-radius:6px;transition:background .15s}
        .sc input[type=checkbox]{width:14px;height:14px;accent-color:var(--teal);cursor:pointer}
        .sc-body{flex:1;min-width:0;display:flex;flex-direction:column;gap:0}
        .sc-top{display:flex;align-items:center;gap:6px;min-width:0}
        .sc-vendor{font-weight:700;font-size:15px;letter-spacing:-.01em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px;color:var(--accent)}
        .sc-key-vals{display:flex;gap:8px;align-items:center;margin-left:auto;flex-shrink:0}
        .sc-key-val{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;white-space:nowrap;color:var(--text)}
        .sc-badges{display:flex;gap:3px;align-items:center;flex-wrap:wrap;margin-top:1px}
        .sc-badges .badge{font-size:7px;padding:1px 4px}
        .sc-more-badge{font-size:7px;padding:1px 4px;border-radius:3px;background:var(--bg3);color:var(--muted);cursor:default}
        .ring{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;border:2px solid;flex-shrink:0}
        .ring.hi{border-color:var(--green);color:var(--green);background:var(--green-light)}
        .ring.mid{border-color:var(--amber);color:var(--amber);background:var(--amber-light)}
        .ring.lo{border-color:var(--red);color:var(--red);background:var(--red-light)}
        .sc-details{display:flex;gap:10px;font-size:11px;align-items:center}
        .sc-detail{display:flex;gap:2px;align-items:center}
        .sc-detail-label{font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:.4px;font-weight:700}
        .sc-detail-val{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:600;color:var(--text)}
        .search-all-bar{display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 16px;margin-top:8px;border-radius:8px;background:linear-gradient(135deg,var(--teal-light),#e8edf4);border:1px solid rgba(61,104,149,.15);cursor:pointer;transition:all .2s}
        .search-all-bar:hover{background:linear-gradient(135deg,#dce3ef,#d0d8e8);border-color:rgba(61,104,149,.3);box-shadow:0 2px 8px rgba(61,104,149,.1)}
        .search-all-bar-text{font-size:13px;font-weight:700;color:var(--teal)}
        .search-all-bar-sub{font-size:11px;color:var(--teal);opacity:.7}
        .badge{display:inline-block;font-size:9px;font-weight:700;padding:2px 7px;border-radius:4px;text-transform:uppercase;letter-spacing:.3px;border:1px solid rgba(0,0,0,.06)}
        .b-auth{background:var(--green-light);color:var(--green)}
        .b-src{background:var(--teal-light);color:var(--teal)}
        .b-email{background:#eaeff5;color:#3d6895;border:1px solid rgba(61,104,149,.1)}
        .b-hist{background:#f0e6ff;color:#7b4fb0}
        .sc-actions-right{display:flex;flex-direction:column;gap:2px;align-items:flex-end;flex-shrink:0;margin-left:auto}
        .btn-call{display:inline-flex;align-items:center;gap:3px;padding:2px 7px;border-radius:4px;font-size:10px;font-weight:700;background:var(--teal-light);color:var(--teal);border:1px solid rgba(61,104,149,.2);cursor:pointer;text-decoration:none;transition:.15s}
        .btn-call:hover{background:rgba(61,104,149,.15)}
        .btn-link{display:inline-flex;align-items:center;gap:2px;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:600;background:#eaeff5;color:#3d6895;border:1px solid rgba(61,104,149,.15);cursor:pointer;text-decoration:none;transition:.15s}
        .btn-link:hover{background:rgba(61,104,149,.12)}
        .sc-hist{border-left:3px solid #c4a0e8;opacity:0.85}

        /* Vendor card rating in search results */
        .sc-rating{cursor:pointer;display:inline-flex;align-items:center;gap:2px;padding:1px 4px;border-radius:3px;transition:.15s}
        .sc-rating:hover{background:var(--amber-light)}
        .sc-rating-new{cursor:default;color:var(--muted);font-size:11px}
        .stars{color:var(--amber);font-size:11px;letter-spacing:-1px}
        .stars-num{font-size:10px;font-weight:700;color:var(--text);margin-left:1px;font-family:'JetBrains Mono',monospace}
        .stars-count{font-size:10px;color:var(--muted);margin-left:1px}
        .stars-none{color:var(--muted);font-size:13px}

        /* Activity — Summary stats */
        .act-summary{display:flex;gap:8px;margin-bottom:12px}
        .act-stat{flex:1;padding:12px 16px;border-radius:10px;background:var(--white);border:1px solid var(--border);cursor:pointer;transition:all .2s ease;text-align:center;box-shadow:var(--shadow-sm)}
        .act-stat:hover{border-color:var(--border2);box-shadow:var(--shadow-md)}
        .act-stat.on{border-color:var(--teal);background:var(--teal-light)}
        .act-stat-num{font-size:22px;font-weight:800;font-family:'JetBrains Mono',monospace}
        .act-stat-label{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);margin-top:2px}
        .act-stat-sent .act-stat-num{color:var(--teal)}
        .act-stat-replied .act-stat-num{color:var(--green)}
        .act-stat-opened .act-stat-num{color:#2563eb}
        .act-stat-awaiting .act-stat-num{color:var(--amber)}

        /* Activity — Vendor cards */
        .act-card{background:var(--white);border:1px solid var(--border);border-left:3px solid var(--border2);border-radius:10px;padding:14px 16px;margin-bottom:6px;transition:all .2s ease;box-shadow:var(--shadow-sm)}
        .act-card:hover{border-color:var(--border2);border-left-color:var(--teal);box-shadow:var(--shadow-md)}
        .act-card-header{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
        .act-card-vendor{font-size:16px;font-weight:700;color:var(--accent)}
        .act-badge-replied{font-size:9px;font-weight:700;padding:2px 8px;border-radius:4px;background:var(--green-light);color:var(--green);text-transform:uppercase}
        .act-badge-awaiting{font-size:9px;font-weight:700;padding:2px 8px;border-radius:4px;background:#fef3c7;color:#92400e;text-transform:uppercase}
        .act-badge-opened{font-size:9px;font-weight:700;padding:2px 8px;border-radius:4px;background:#dbeafe;color:#1e40af;text-transform:uppercase}
        .act-badge-unavail{font-size:9px;font-weight:700;padding:2px 8px;border-radius:4px;background:#fce4ec;color:#b71c1c;text-transform:uppercase}
        .act-badge-type{font-size:9px;font-weight:700;padding:2px 7px;border-radius:4px;text-transform:uppercase;letter-spacing:.3px}
        .act-badge-email{background:var(--teal-light);color:var(--teal)}
        .act-badge-phone{background:var(--green-light);color:var(--green)}
        .act-card-date{font-size:11px;color:var(--text2);font-weight:600;font-family:'JetBrains Mono',monospace;margin-left:auto;white-space:nowrap}
        .act-card-meta{font-size:12px;color:var(--text);margin-top:6px;display:flex;gap:12px;flex-wrap:wrap}
        .act-card-meta-item{display:flex;gap:4px;align-items:center}
        .act-card-meta-label{font-size:10px;text-transform:uppercase;color:var(--muted);font-weight:600;letter-spacing:.3px}
        .act-card-parts{display:flex;gap:5px;margin-top:8px;flex-wrap:wrap}
        .act-card-part{font-size:11px;font-family:'JetBrains Mono',monospace;background:var(--surface);padding:2px 8px;border-radius:4px;color:var(--text2)}
        .act-card-quote{margin-top:8px;padding:8px 12px;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:6px;font-size:12px}
        .act-card-quote-line{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
        .act-card-quote-mpn{font-family:'JetBrains Mono',monospace;font-weight:700;font-size:13px;color:var(--green)}
        .act-card-quote-val{font-size:11px;color:var(--text2)}
        .act-card-actions{display:flex;gap:6px;margin-top:8px;justify-content:flex-end;flex-wrap:wrap}
        .act-badge-classification{font-size:9px;font-weight:700;padding:2px 7px;border-radius:4px;background:#f0e6ff;color:#7b4fb0;text-transform:uppercase;letter-spacing:.3px}
        .act-action-hint{font-size:10px;color:var(--teal);font-weight:600;padding:2px 6px}

        /* Filter bar — shared across tabs */
        .filter-bar{display:flex;gap:8px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
        .filter-search{flex:1;min-width:180px;max-width:320px;padding:8px 12px 8px 32px;border:1px solid var(--border);border-radius:8px;background:var(--surface) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'/%3E%3C/svg%3E") no-repeat 10px center;font-size:13px;color:var(--text);transition:.15s;outline:none}
        .filter-search:focus{border-color:var(--teal);box-shadow:0 0 0 2px rgba(61,104,149,.12)}
        .filter-search::placeholder{color:var(--muted)}
        .filter-pills{display:flex;gap:4px;align-items:center}
        .filter-pill{padding:5px 12px;border-radius:6px;border:1px solid var(--border);background:var(--white);color:var(--text2);font-size:11px;font-weight:600;cursor:pointer;transition:.15s;white-space:nowrap}
        .filter-pill:hover{border-color:var(--border2);background:var(--surface)}
        .filter-pill.on{background:var(--blue);color:#fff;border-color:var(--blue)}
        .filter-count{font-size:11px;color:var(--muted);margin-left:auto;white-space:nowrap}
        .filter-sort{padding:5px 10px;border-radius:6px;border:1px solid var(--border);background:var(--white);color:var(--text2);font-size:11px;font-weight:600;cursor:pointer;outline:none;appearance:auto}

        /* Modal */
        .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:100;padding:20px;backdrop-filter:blur(4px)}
        .modal-bg.open{display:flex}
        .modal{background:var(--white);border:1px solid var(--border);border-radius:16px;max-width:640px;width:100%;max-height:85vh;overflow-y:auto;padding:24px;box-shadow:0 16px 56px rgba(0,0,0,.2),0 4px 12px rgba(0,0,0,.08)}
        .modal-lg{max-width:760px}
        .modal h2{font-size:16px;font-weight:800;margin-bottom:16px}
        .modal .field{margin-bottom:12px}
        .mactions{display:flex;justify-content:flex-end;gap:8px;margin-top:16px}
        .field{display:flex;flex-direction:column;gap:3px}
        .field label{font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.4px}
        .field input,.field textarea{background:var(--input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;font-size:12px;color:var(--text);transition:.15s}
        .field input:focus,.field textarea:focus{outline:none;border-color:var(--teal);box-shadow:0 0 0 2px rgba(61,104,149,.1);background:var(--white)}
        .field textarea{font-family:'JetBrains Mono',monospace;min-height:60px;resize:vertical;font-size:11px}

        /* Upload */
        .uzone{border:2px dashed var(--border);border-radius:8px;padding:24px;text-align:center;cursor:pointer;transition:.15s;margin-bottom:12px}
        .uzone:hover,.uzone.drag{border-color:var(--teal);background:var(--teal-light)}
        .uzone input{display:none}
        .uzone-label{color:var(--text2);font-size:12px}
        .uzone-hint{color:var(--muted);font-size:10px;margin-top:3px}
        .ustatus{font-size:11px;margin-top:8px;padding:8px 12px;border-radius:6px;display:none}
        .ustatus.ok{display:block;background:var(--green-light);color:var(--green)}
        .ustatus.err{display:block;background:var(--red-light);color:var(--red)}
        .ustatus.load{display:block;background:var(--teal-light);color:var(--teal)}

        /* RFQ Prepare/Ready flow */
        .rfq-vendor-row{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border:1px solid var(--border);border-radius:6px;margin-bottom:4px;gap:8px;background:var(--white)}
        .rfq-vendor-info{flex:1;min-width:0}
        .rfq-vendor-info strong{font-size:12px;display:block}
        .rfq-vendor-parts{font-size:10px;color:var(--muted);font-family:'JetBrains Mono',monospace}
        .rfq-src-badge{font-size:9px;padding:1px 5px;border-radius:3px;background:#eaeff5;color:#3d6895;border:1px solid rgba(61,104,149,.15)}
        .rfq-email-row{display:flex;align-items:center;gap:6px}
        .email-select{background:var(--input);border:1px solid var(--border);border-radius:5px;padding:4px 6px;font-size:11px;font-family:'JetBrains Mono',monospace;color:var(--text);max-width:240px}
        .email-select:focus{outline:none;border-color:var(--teal)}
        .email-loading{font-size:10px;color:var(--amber);font-weight:600;padding:3px 8px;background:var(--amber-light);border-radius:4px;border:1px solid rgba(217,136,11,.15);animation:pulse 1.5s ease-in-out infinite}
        .email-none{font-size:10px;color:var(--red);font-weight:600}
        .rfq-email-input{background:var(--input);border:1px solid var(--border);border-radius:5px;padding:4px 6px;font-size:11px;font-family:'JetBrains Mono',monospace;color:var(--text);width:180px}
        .rfq-email-input:focus{outline:none;border-color:var(--teal)}
        .rfq-condition{display:flex;align-items:center;gap:6px;margin-bottom:12px}
        .rfq-condition label{font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-right:4px}
        .rfq-cond-btn{padding:5px 14px;border:1px solid var(--border);border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;background:var(--white);color:var(--text2);transition:.15s}
        .rfq-cond-btn:hover{border-color:var(--teal);color:var(--teal)}
        .rfq-cond-btn.active{background:var(--teal);color:var(--white);border-color:var(--teal)}
        .rfq-parts-breakdown{display:flex;flex-wrap:wrap;gap:4px;margin-top:3px}
        .rfq-parts-tag{font-size:10px;padding:2px 7px;border-radius:4px;font-family:'JetBrains Mono',monospace}
        .rfq-parts-listing{background:#e8f5e9;color:#2e7d32}
        .rfq-parts-other{background:#e3f2fd;color:#1565c0}
        .rfq-exhaust-full{font-size:10px;color:var(--amber);font-weight:600;display:block;margin-top:3px}
        .rfq-exhaust-partial{font-size:10px;color:var(--text2);display:block;margin-top:3px}
        .rfq-exhaust-btn{font-size:10px;padding:2px 8px;border:1px solid var(--amber);border-radius:4px;background:#fffbe6;color:var(--amber);cursor:pointer;margin-left:6px;font-weight:600}
        .rfq-exhaust-btn:hover{background:var(--amber);color:var(--white)}
        .rfq-exhaust-override{font-size:10px;color:var(--teal);font-weight:600;margin-left:6px}
        .rfq-vendor-exhausted{opacity:0.45}
        .rfq-vendor-exhausted:hover{opacity:0.75}
        .rfq-vendor-excluded{opacity:0.35;background:var(--bg2)}
        .rfq-vendor-excluded:hover{opacity:0.6}
        .rfq-vendor-cb{width:16px;height:16px;accent-color:var(--teal);cursor:pointer;flex-shrink:0}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

        /* Vendor Card Popup */
        .vp-header{margin-bottom:16px}
        .vp-header h2{font-size:18px;margin-bottom:4px}
        .vp-rating{display:flex;align-items:center;gap:4px}
        .vp-section{margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--card2)}
        .vp-label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}
        .vp-field{font-size:12px;margin-bottom:3px}
        .vp-field .vp-label{display:inline;margin-right:6px}
        .vp-field a{color:var(--teal);text-decoration:none}
        .vp-field a:hover{text-decoration:underline}
        .vp-item{font-size:12px;padding:2px 0}
        .vp-item a{color:var(--teal);text-decoration:none;font-family:'JetBrains Mono',monospace;font-size:11px}
        .vp-item a:hover{text-decoration:underline}
        .vp-muted{color:var(--muted);font-style:italic}
        .vp-review{padding:8px 10px;border:1px solid var(--card2);border-radius:6px;margin-bottom:4px}
        .vp-review-header{display:flex;justify-content:space-between;align-items:center}
        .vp-review-header .stars{font-size:13px;letter-spacing:0}
        .vp-review-author{font-size:10px;color:var(--muted)}
        .vp-review-comment{font-size:11px;color:var(--text2);margin-top:4px}
        .vp-review-form{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
        .vp-star-picker{display:flex;gap:2px}
        .vp-star{font-size:20px;color:var(--amber);cursor:pointer;transition:.1s}
        .vp-star:hover{transform:scale(1.2)}
        .vp-input{background:var(--input);border:1px solid var(--border);border-radius:5px;padding:5px 8px;font-size:11px;color:var(--text);flex:1;min-width:120px}
        .vp-input:focus{outline:none;border-color:var(--teal)}

        /* Blacklist toggle */
        .btn-blacklist{padding:5px 12px;border-radius:6px;font-size:11px;font-weight:700;cursor:pointer;transition:.15s;border:1px solid}
        .vp-bl-off{background:var(--white);border-color:var(--border);color:var(--text2)}
        .vp-bl-off:hover{background:var(--red-light);border-color:var(--red);color:var(--red)}
        .vp-bl-on{background:var(--red-light);border-color:var(--red);color:var(--red)}
        .vp-bl-on:hover{background:var(--white);border-color:var(--border);color:var(--text2)}
        .vendor-card-bl{opacity:0.5}

        /* Vendors List View */
        .vendor-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .vendor-header h2{font-size:16px;font-weight:700}
        .vendor-search{background:var(--input);border:1px solid var(--border);border-radius:6px;padding:7px 12px;font-size:12px;color:var(--text);width:240px}
        .vendor-search:focus{outline:none;border-color:var(--teal);background:var(--white)}
        .vendor-card-row{display:flex;justify-content:space-between;align-items:center}
        .vendor-card-name{font-weight:700;font-size:14px;color:var(--accent)}
        .vendor-card-meta{display:flex;gap:12px;align-items:center}
        .eng-badge{font-size:10px;font-weight:700;padding:2px 6px;border-radius:8px;white-space:nowrap}
        .eng-proven{background:#e6f9ed;color:#1a7a3a}.eng-developing{background:#fff8e1;color:#b8860b}.eng-caution{background:#fde8e8;color:#c0392b}.eng-new{background:var(--bg3);color:var(--muted)}

        /* Material history badge in search results */
        .b-mathistory{background:#e6f0e6;color:#3a7a3a;border:1px solid rgba(58,122,58,.12)}
        .sc-mathistory{border-left:3px solid #6ab36a;opacity:0.9}

        /* Material Card styles (list + popup) */
        .mat-card-row{display:flex;justify-content:space-between;align-items:center}
        .mat-card-mpn{font-weight:700;font-size:15px;font-family:'JetBrains Mono',monospace;color:var(--green)}
        .mat-card-meta{display:flex;gap:12px;align-items:center;font-size:11px;color:var(--muted)}
        .mp-header{margin-bottom:16px}
        .mp-header h2{font-size:18px;margin-bottom:2px;font-family:'JetBrains Mono',monospace}
        .mp-header-meta{font-size:12px;color:var(--muted)}
        .mp-section{margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--card2)}
        .mp-label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}
        .mp-vh-row{display:flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--card2);border-radius:6px;margin-bottom:3px;font-size:11px;cursor:pointer;transition:.15s}
        .mp-vh-row:hover{border-color:var(--border2);background:var(--bg)}
        .mp-vh-vendor{font-weight:700;min-width:140px;color:var(--accent)}
        .mp-vh-detail{color:var(--text);font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:500}
        .mp-vh-badge{font-size:8px;font-weight:700;padding:1px 5px;border-radius:3px;text-transform:uppercase}
        .mp-vh-times{background:#eaeff5;color:#3d6895;font-size:9px;font-weight:700;padding:1px 5px;border-radius:3px}
        .mp-empty{font-size:12px;color:var(--muted);font-style:italic;padding:8px 0}
        .mp-table-wrap{overflow-x:auto;margin-top:4px}
        .mp-tbl{width:100%;font-size:11px;border-collapse:collapse}
        .mp-tbl th{text-align:left;padding:5px 8px;color:var(--muted);font-weight:600;font-size:9px;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--border)}
        .mp-tbl td{padding:5px 8px;border-bottom:1px solid var(--card2);vertical-align:middle}
        .mp-tbl tr:hover td{background:var(--bg)}
        .mp-tbl-vendor{font-weight:700;font-size:13px;max-width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--accent)}
        .mp-tbl-date{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text2);white-space:nowrap;font-weight:500}

        @media(max-width:768px){
            /* Sidebar → hidden drawer on mobile */
            .sidebar{width:var(--sbw);top:0;transform:translateX(-100%);transition:transform .22s cubic-bezier(.4,0,.2,1);box-shadow:none}
            .sidebar.mobile-open{transform:translateX(0);box-shadow:4px 0 20px rgba(0,0,0,.3)}
            .sidebar.collapsed{transform:translateX(-100%)}
            .main{margin-left:0 !important;padding:12px 10px;padding-top:52px}
            .mobile-topbar{display:flex !important}

            /* Req list */
            .col-headers{display:none}
            .req-row{grid-template-columns:1fr;gap:4px;padding:10px 14px}
            .req-row .c-src{display:none}
            .req-header{flex-direction:column;gap:8px;align-items:stretch}
            .req-header > div{flex-direction:column;gap:6px;display:flex}
            .req-search{width:100%;font-size:16px}
            .req-card{flex-direction:column;align-items:flex-start;gap:6px}
            .req-meta{flex-wrap:wrap;gap:8px}
            .req-actions{width:100%;justify-content:flex-end}

            /* Detail header */
            .detail-header{flex-direction:column;gap:8px;align-items:flex-start}
            .detail-header h2{font-size:14px}

            /* Tabs — horizontal scroll on mobile */
            .tabs{overflow-x:auto;width:100%;-webkit-overflow-scrolling:touch;flex-wrap:nowrap;scrollbar-width:none}
            .tabs::-webkit-scrollbar{display:none}
            .tab{white-space:nowrap;flex-shrink:0;padding:7px 14px;font-size:11px;min-height:34px}

            /* Filter bars — stack */
            .filter-bar{flex-direction:column;gap:6px;align-items:stretch}
            .filter-search{max-width:100%;min-width:0;font-size:16px}
            .filter-pills{flex-wrap:wrap;gap:3px}
            .filter-pill{padding:5px 10px;font-size:10px;min-height:30px;display:inline-flex;align-items:center}
            .filter-count{text-align:right}

            /* Sighting cards — stack layout */
            .sc{flex-direction:column;align-items:flex-start;gap:4px;padding:6px 10px !important}
            .sc input[type=checkbox]{width:18px;height:18px}
            .sc-top{flex-wrap:wrap}
            .sc-vendor{max-width:140px;font-size:13px}
            .sc-key-vals{margin-left:0}
            .sc-details{flex-wrap:wrap;gap:6px}
            .sc-actions-right{flex-direction:row;width:100%;justify-content:flex-end;margin-left:0;margin-top:2px}

            /* Batch RFQ bar */
            #tab-sources > div:first-child{flex-direction:column;gap:6px;align-items:stretch}
            #tab-sources > div:first-child > div{flex-wrap:wrap;justify-content:flex-end}

            /* Activity cards */
            .act-summary{flex-wrap:wrap;gap:6px}
            .act-stat{padding:8px 10px;min-width:70px;flex:1 1 calc(50% - 4px);min-height:60px}
            .act-stat-num{font-size:18px}
            .act-card-header{flex-wrap:wrap;gap:4px}
            .act-card-vendor{font-size:14px}
            .act-card-date{margin-left:0;font-size:10px;width:100%}
            .act-card-meta{flex-direction:column;gap:4px}
            .act-card-parts{gap:3px}
            .act-card-actions{justify-content:flex-start}

            /* RFQ Modal */
            .rfq-vendor-row{flex-direction:column;align-items:flex-start;gap:6px}
            .rfq-email-row{flex-wrap:wrap}
            .rfq-email-input{width:100%;font-size:16px}
            .email-select{max-width:100%;font-size:16px}
            .rfq-condition{flex-wrap:wrap;gap:4px}

            /* Modal — fullscreen-like on mobile */
            .modal-bg{padding:8px;align-items:flex-start;padding-top:40px}
            .modal{padding:16px;max-height:calc(100vh - 60px);border-radius:10px}
            .modal-lg{max-width:100%}
            .modal h2{font-size:15px;margin-bottom:12px}
            .mactions{flex-wrap:wrap}

            /* Fields — 16px prevents iOS zoom */
            .field input,.field textarea{font-size:16px}
            .vp-input{font-size:16px}

            /* Vendor/Material popups */
            .vp-review-form{flex-direction:column;gap:6px;align-items:stretch}
            .vp-input{min-width:0;width:100%}
            .mp-vh-row{flex-wrap:wrap;gap:4px}
            .mp-vh-vendor{min-width:100px}

            /* CRM customers — responsive */
            .cust-sites{padding:8px 10px}
            .cust-site{flex-wrap:wrap;gap:6px}
            .cust-site-name{min-width:auto;flex:1 1 100%}
            .cust-site-owner,.cust-site-reqs{font-size:11px}
            .cust-add-site{text-align:center}

            /* Vendor list */
            .vendor-header{flex-direction:column;gap:8px;align-items:stretch}
            .vendor-search{width:100%;font-size:16px}
            .vendor-card-row{flex-direction:column;gap:4px;align-items:flex-start}
            .vendor-card-meta{flex-wrap:wrap;gap:6px}

            /* Material list */
            .mat-card-row{flex-direction:column;gap:4px;align-items:flex-start}
            .mat-card-meta{flex-wrap:wrap;gap:8px}

            /* Data Sources */
            .src-stats{flex-wrap:wrap;gap:6px}
            .src-stat{min-width:70px;flex:1 1 calc(33% - 8px);padding:8px 10px}
            .src-stat strong{font-size:16px}
            .src-grid{grid-template-columns:1fr}
            .src-card-header{flex-wrap:wrap;gap:6px}
            .src-env-vars{gap:3px}

            /* Upload area */
            .uzone{padding:16px}
            #stockImportArea > div{flex-direction:column}

            /* Buttons — larger touch targets */
            .btn{padding:9px 16px;font-size:12px;min-height:36px}
            .btn-sm{padding:6px 12px;font-size:11px;min-height:30px}
            .btn-out{min-height:30px;padding:6px 12px}
            .btn-call{min-height:30px;padding:6px 12px}
            .btn-archive,.btn-reactivate{min-height:28px}

            /* Login */
            .login-card{padding:40px 24px 36px;width:92%}
            .login-logo{width:240px}
            .btn-ms{padding:14px 24px;font-size:14px;width:100%;justify-content:center}

            /* v7 toparea — stack on mobile */
            .toparea{flex-wrap:wrap;gap:8px;padding:8px 12px}
            .toparea img{height:72px}
            .topcontrols{flex-direction:column;align-items:stretch;gap:6px}
            .fpills{width:100%;overflow-x:auto;scrollbar-width:none}
            .fpills::-webkit-scrollbar{display:none}
            .sbox{width:100%;font-size:16px}
            .filter-panel{width:calc(100vw - 24px);left:-12px}
            .sb-rail{height:90px;width:18px}
            body.sb-open .main{margin-left:0 !important}
            /* v7 table: horizontal scroll on mobile */
            .tbl{display:block;overflow-x:auto;white-space:nowrap}
        }

        /* Mobile top bar (hamburger) — hidden on desktop */
        .mobile-topbar{display:none;position:fixed;top:0;left:0;right:0;height:48px;background:var(--blue);z-index:40;align-items:center;padding:0 12px;gap:10px}
        .mobile-topbar .hamburger{background:none;border:none;color:var(--navy-nav-active);font-size:22px;cursor:pointer;padding:4px 8px}
        .mobile-topbar .mobile-logo{height:30px;filter:brightness(0) invert(1);opacity:.9}
        .sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.3);z-index:45}
        .sidebar-overlay.open{display:block}

        /* Extra small screens (phones in portrait) */
        @media(max-width:420px){
            .tab{font-size:10px;padding:6px 10px}
            .sc-vendor{font-size:12px}
            .act-stat{flex:1 1 calc(50% - 3px)}
            .act-stat-num{font-size:16px}
            .act-stat-label{font-size:9px}
            .src-stat{flex:1 1 calc(50% - 4px)}
            .btn-primary{padding:8px 12px}
            .login-card{padding:32px 16px 28px}
            .login-logo{width:200px}
        }

        /* ── Data Sources Tab ── */
        .src-stats{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap}
        .src-stat{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:12px 16px;text-align:center;min-width:100px}
        .src-stat strong{display:block;font-size:20px;color:var(--teal);font-weight:700}
        .src-stat span{font-size:11px;color:var(--text2)}
        .src-section{margin-bottom:24px}
        .src-section-title{font-size:14px;font-weight:700;margin-bottom:12px;padding-bottom:6px;border-bottom:1px solid var(--border)}
        .src-live-title{color:#10b981}
        .src-error-title{color:#ef4444}
        .src-pending-title{color:#f59e0b}
        .src-disabled-title{color:#9ca3af}
        .src-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:12px}
        .src-card{background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px;transition:.15s}
        .src-card:hover{border-color:var(--teal);box-shadow:0 2px 8px rgba(61,104,149,.08)}
        .src-card-live{border-left:3px solid #10b981}
        .src-card-pending{border-left:3px solid #f59e0b;opacity:.85}
        .src-card-error{border-left:3px solid #ef4444}
        .src-card-disabled{border-left:3px solid #9ca3af;opacity:.6}
        .src-card-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
        .src-icon{font-size:20px}
        .src-card-title{flex:1}
        .src-card-title strong{font-size:13px;display:block}
        .src-type-badge{font-size:9px;font-weight:600;padding:1px 6px;border-radius:3px;background:var(--teal-light);color:var(--teal);text-transform:uppercase}
        .src-status-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
        .src-desc{font-size:11px;color:var(--text2);margin:0 0 8px;line-height:1.4}
        .src-env-vars{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px}
        .src-env{font-size:9px;font-family:'JetBrains Mono',monospace;padding:2px 6px;border-radius:3px;font-weight:600}
        .src-env-set{background:#d1fae5;color:#065f46}
        .src-env-missing{background:#fef2f2;color:#991b1b}
        .src-card-stats{font-size:10px;color:var(--text2);margin-bottom:6px;font-family:'JetBrains Mono',monospace}
        .src-last-ok{font-size:10px;color:#10b981;margin-bottom:2px}
        .src-last-err{font-size:10px;color:#ef4444;margin-bottom:4px;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .src-setup-notes{font-size:10px;color:var(--text2);background:#fffbeb;border:1px solid #fde68a;border-radius:4px;padding:6px 8px;margin-bottom:8px;line-height:1.4}
        .src-actions{display:flex;gap:6px;flex-wrap:wrap}
        .src-test-btn{background:var(--teal-light);color:var(--teal);border:1px solid rgba(61,104,149,.2)}
        .src-test-btn:hover{background:var(--teal);color:white}

        /* EXACT/SUB badges */
        .b-exact{background:#d1fae5;color:#065f46}
        .b-sub{background:#e0f4f7;color:#0e7490}
        .sc-sub{background:#f5f5f5;border-left:3px solid #d1d5db}

        /* Unavailable/Sold state */
        .b-unavail{background:#fef2f2;color:#991b1b}
        .b-cond-new{background:#d1fae5;color:#065f46;font-weight:600}
        .b-cond-ref{background:#fef3c7;color:#92400e;font-weight:600}
        .sc-unavailable{opacity:0.55;text-decoration:line-through}
        .sc-unavailable .sc-vendor{text-decoration:line-through}
        .btn-unavail{font-size:10px;padding:2px 7px;border-radius:4px;border:1px solid var(--border);background:var(--surface);color:var(--text2);cursor:pointer}
        .btn-unavail:hover{background:#fef2f2;color:#991b1b;border-color:#fca5a5}

        /* Source toggle switches */
        .src-toggle{position:relative;display:inline-flex;align-items:center;gap:6px;cursor:pointer;font-size:11px;flex-shrink:0}
        .src-toggle input{opacity:0;width:0;height:0;position:absolute}
        .src-toggle-slider{position:relative;width:32px;height:18px;background:#ccc;border-radius:9px;transition:.2s}
        .src-toggle-slider::before{content:'';position:absolute;width:14px;height:14px;left:2px;top:2px;background:white;border-radius:50%;transition:.2s}
        .src-toggle input:checked + .src-toggle-slider{background:#10b981}
        .src-toggle input:checked + .src-toggle-slider::before{transform:translateX(14px)}
        .src-toggle-label{font-weight:600;color:var(--text2)}

        /* ── v1.2.0 CRM ────────────────────────────────── */

        /* Status badges */
        .status-badge{display:inline-block;font-size:9px;font-weight:700;padding:2px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.3px;border:1px solid rgba(0,0,0,.08)}
        .status-active{background:var(--blue-lt);color:var(--blue)}
        .status-sourcing{background:var(--blue-lt);color:var(--blue)}
        .status-quoting{background:var(--amber-light);color:var(--amber)}
        .status-quoted{background:var(--green-light);color:#065f46}
        .status-won{background:var(--green-light);color:#065f46}
        .status-lost{background:var(--red-light);color:#991b1b}
        .status-reopened{background:var(--blue-lt);color:var(--blue)}
        .status-archived{background:var(--amber-light);color:#92400e}
        .status-draft{background:var(--bg2);color:var(--text2)}
        .status-chip{display:inline-block;font-size:10px;font-weight:700;padding:3px 10px;border-radius:10px;text-transform:uppercase;letter-spacing:.4px;transition:all .3s}
        .status-chip.pulse{animation:chipPulse .6s ease}
        @keyframes chipPulse{0%{transform:scale(1)}30%{transform:scale(1.15)}100%{transform:scale(1)}}
        .status-sent{background:#dbeafe;color:#2563eb}
        .status-revised{background:var(--bg);color:var(--muted)}
        .status-offers{background:var(--purple-lt);color:var(--purple)}

        /* Customers tree */
        .cust-card{padding:0;overflow:hidden}
        .cust-header{display:flex;align-items:center;gap:8px;padding:14px 16px;cursor:pointer;user-select:none;transition:background .15s}
        .cust-header:hover{background:var(--bg)}
        .cust-expand{font-size:10px;color:var(--muted);transition:transform .2s;width:14px}
        .cust-card.expanded .cust-expand{transform:rotate(90deg)}
        .cust-name{font-weight:800;font-size:17px;flex:1;color:var(--accent)}
        .cust-count{font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace}
        .cust-acct-mgr{font-size:10px;color:var(--text2);margin-left:4px}
        .cust-sites{display:none;border-top:1px solid var(--border);padding:8px 16px}
        .cust-card.expanded .cust-sites{display:block}
        .cust-site{display:flex;align-items:center;gap:12px;padding:8px 10px;border-radius:6px;cursor:pointer;transition:.15s;font-size:12px}
        .cust-site:hover{background:var(--bg)}
        .cust-site-name{font-weight:600;min-width:120px}
        .cust-site-owner{color:var(--text2);min-width:80px}
        .cust-site-reqs{color:var(--muted);font-size:11px;font-family:'JetBrains Mono',monospace}
        .cust-add-site{padding:4px 0;border-top:1px solid var(--card2);margin-top:4px}
        .site-detail-panel{padding:8px 10px;background:var(--surface);border-radius:6px;margin:4px 0}
        .si-row{display:flex;gap:8px;padding:4px 0;font-size:12px;border-bottom:1px solid rgba(0,0,0,.03)}
        .si-label{font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;min-width:70px;padding-top:2px}
        .si-reqs{margin-top:8px}
        .si-req{display:flex;gap:10px;align-items:center;font-size:11px;padding:4px 6px;border-radius:4px;cursor:pointer;transition:.15s}
        .si-req:hover{background:var(--bg)}
        .si-req span:first-child{font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--teal)}
        .site-info a{color:var(--teal);text-decoration:none}
        .site-info a:hover{text-decoration:underline}

        /* Site contacts */
        .si-contacts{margin:8px 0}
        .si-contacts-title{font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.4px}
        .si-contact-search{width:100%;padding:5px 8px;border:1px solid var(--border);border-radius:5px;font-size:11px;margin:6px 0;background:var(--white);outline:none}
        .si-contact-search:focus{border-color:var(--teal);box-shadow:0 0 0 2px rgba(61,104,149,.1)}
        .si-contact-grid{display:flex;flex-direction:column;gap:4px;max-height:320px;overflow-y:auto;margin-top:4px}
        .si-contact-card{display:flex;align-items:flex-start;gap:8px;padding:8px 10px;border-radius:6px;border:1px solid var(--border);background:var(--white);font-size:12px;transition:.15s}
        .si-contact-card:hover{border-color:var(--teal);box-shadow:0 1px 4px rgba(61,104,149,.06)}
        .si-contact-left{flex-shrink:0}
        .si-contact-avatar{width:28px;height:28px;border-radius:50%;background:var(--teal-light);color:var(--teal);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700}
        .si-contact-info{flex:1;min-width:0}
        .si-contact-row1{display:flex;align-items:center;gap:4px}
        .si-contact-name{font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .si-contact-badge{font-size:8px;background:var(--teal);color:#fff;padding:1px 5px;border-radius:8px;flex-shrink:0}
        .si-contact-title{color:var(--muted);font-size:10px;margin-top:1px}
        .si-contact-meta{display:flex;gap:8px;font-size:11px;color:var(--text2);margin-top:2px;flex-wrap:wrap}
        .si-contact-meta a{color:var(--teal);text-decoration:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:200px}
        .si-contact-meta a:hover{text-decoration:underline}
        .si-contact-phone{color:var(--text2) !important}
        .si-contact-notes{font-size:10px;color:var(--muted);margin-top:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .si-contact-actions{display:flex;gap:4px;flex-shrink:0;opacity:0;transition:opacity .15s}
        .si-contact-card:hover .si-contact-actions{opacity:1}

        /* CRM Activity rows */
        .cust-activity-section{border-top:1px solid var(--border);margin-top:8px;padding-top:8px}
        .act-row{display:flex;gap:8px;align-items:flex-start;padding:5px 0;border-bottom:1px solid rgba(0,0,0,.04);font-size:11px}
        .act-row-icon{flex-shrink:0;width:18px;text-align:center}
        .act-row-body{flex:1;min-width:0}
        .act-row-label{font-weight:600;text-transform:capitalize}
        .act-row-subject{color:var(--text2);font-size:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .act-row-meta{color:var(--muted);white-space:nowrap;font-size:10px;flex-shrink:0}

        /* Offers tab */
        .offer-group{margin-bottom:16px;background:var(--white);border:1px solid var(--border);border-radius:8px;overflow:hidden}
        .offer-group-header{display:flex;align-items:center;gap:12px;padding:10px 14px;background:var(--surface);border-bottom:1px solid var(--border);font-size:12px}
        .offer-group-header strong{font-family:'JetBrains Mono',monospace;font-size:13px}
        .offer-group-header span{color:var(--muted)}
        .offer-table{margin-bottom:0}
        .offer-table tr.offer-ref{opacity:.5}
        .offer-ref-badge{font-size:9px;color:var(--muted);font-style:italic}
        .tab.tab-new{background:#22c55e;color:#fff}
        .tab.tab-new.on{background:#16a34a}
        .tab.tab-urgent{background:#dc2626;color:#fff}
        .tab.tab-urgent.on{background:#b91c1c}
        .new-offers-dot{display:inline-block;width:8px;height:8px;border-radius:50%;background:#22c55e;margin-left:4px;vertical-align:middle;animation:pulse-dot 2s ease-in-out infinite}
        .new-offers-dot.red{background:#dc2626}
        @keyframes pulse-dot{0%,100%{opacity:1}50%{opacity:.4}}

        /* Offer filter bar */
        .offer-filter-bar{display:flex;align-items:center;gap:8px;margin-bottom:12px;flex-wrap:wrap}
        .offer-filter-bar .filter-pills{flex-shrink:0}
        .offer-sort{padding:5px 10px;border-radius:6px;border:1px solid var(--border);background:var(--white);color:var(--text2);font-size:11px;font-weight:600;cursor:pointer;outline:none;appearance:auto}
        .offer-expired{opacity:.55}

        /* Meta-link — subtle clickable text */
        .meta-link{color:var(--text2);text-decoration:none;font-size:11px;transition:color .15s;cursor:pointer}
        .meta-link:hover{color:var(--teal)}

        /* Nav badge */
        .nav-badge{display:inline-flex;align-items:center;justify-content:center;min-width:16px;height:16px;padding:0 4px;border-radius:8px;background:var(--red);color:#fff;font-size:9px;font-weight:700;margin-left:4px;line-height:1}

        /* Proactive */
        .proactive-group{background:var(--white);border:1px solid var(--border);border-left:3px solid var(--border2);border-radius:8px;padding:14px 16px;margin-bottom:10px;box-shadow:var(--shadow-sm)}
        .proactive-group h3{font-size:14px;font-weight:700;margin-bottom:8px}
        .proactive-match{display:flex;align-items:center;gap:10px;padding:6px 0;border-bottom:1px solid var(--bg);font-size:12px}
        .proactive-match:last-child{border-bottom:none}
        .proactive-match label{display:flex;align-items:center;gap:6px;cursor:pointer;flex:1}
        .proactive-match .pm-mpn{font-family:'JetBrains Mono',monospace;font-weight:700;font-size:14px;min-width:120px;color:var(--green)}
        .proactive-match .pm-vendor{color:var(--accent);font-weight:700;min-width:100px}
        .proactive-match .pm-detail{color:var(--muted)}
        .proactive-actions{display:flex;gap:6px;margin-top:10px}
        .proactive-offer-card{background:var(--white);border:1px solid var(--border);border-left:3px solid var(--green);border-radius:8px;padding:14px 16px;margin-bottom:8px;box-shadow:var(--shadow-sm)}
        .proactive-offer-card .po-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
        .proactive-offer-card .po-header strong{font-size:13px}
        .proactive-offer-card .po-items{font-size:12px;color:var(--text2);margin-bottom:6px}
        .proactive-offer-card .po-footer{display:flex;gap:16px;font-size:11px;color:var(--muted)}
        .scorecard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:20px}
        .scorecard-card{background:var(--white);border:1px solid var(--border);border-radius:8px;padding:16px;text-align:center}
        .scorecard-card .sc-value{font-size:28px;font-weight:800;color:var(--teal);font-family:'JetBrains Mono',monospace}
        .scorecard-card .sc-label{font-size:11px;color:var(--muted);margin-top:4px;text-transform:uppercase;font-weight:600;letter-spacing:.3px}
        .sell-price-input{width:80px;padding:4px 6px;border:1px solid var(--border);border-radius:4px;font-size:12px;font-family:'JetBrains Mono',monospace;text-align:right}
        .send-preview{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:10px 14px;margin-top:10px;font-size:12px}
        .send-preview .sp-row{display:flex;justify-content:space-between;padding:2px 0}
        .send-preview .sp-total{font-weight:700;border-top:1px solid var(--border);margin-top:4px;padding-top:4px}

        /* Quote tab */
        .quote-header{display:flex;justify-content:space-between;align-items:flex-start;padding:12px 16px;background:var(--surface);border:1px solid var(--border);border-radius:8px;margin-bottom:12px}
        .quote-header strong{font-size:15px;font-family:'JetBrains Mono',monospace}
        .quote-table .quote-cost{color:var(--muted);font-family:'JetBrains Mono',monospace}
        .quote-sell-input{width:80px;padding:4px 6px;border:1px solid var(--border);border-radius:4px;font-size:12px;font-family:'JetBrains Mono',monospace;text-align:right}
        .quote-sell-input:focus{outline:none;border-color:var(--teal)}
        .quote-cell-input{padding:2px 4px;border:1px solid var(--border);border-radius:3px;font-size:11px;background:var(--bg);color:var(--text)}
        .quote-cell-input:focus{outline:none;border-color:var(--teal)}
        .quote-margin{font-family:'JetBrains Mono',monospace;font-weight:600}
        .quote-markup{display:flex;align-items:center;gap:8px;padding:8px 14px;font-size:12px;color:var(--text2);border-top:1px solid var(--card2);margin-top:0}
        .quote-markup input{width:50px;padding:4px 6px;border:1px solid var(--border);border-radius:4px;font-size:12px;text-align:center}
        .quote-totals{display:flex;gap:24px;padding:12px 14px;background:var(--surface);border:1px solid var(--border);border-radius:8px;margin:12px 0;font-size:13px}
        .quote-totals strong{font-family:'JetBrains Mono',monospace}
        .quote-terms{display:flex;gap:12px;flex-wrap:wrap;padding:8px 0;font-size:12px}
        .quote-terms label{display:flex;align-items:center;gap:6px;color:var(--text2);font-size:11px;font-weight:600}
        .quote-terms input{padding:5px 8px;border:1px solid var(--border);border-radius:5px;font-size:12px;background:var(--input)}
        .quote-terms input:focus{outline:none;border-color:var(--teal)}
        .quote-notes textarea{background:var(--input);border:1px solid var(--border);border-radius:6px;padding:8px;font-size:12px;resize:vertical}
        .quote-notes textarea:focus{outline:none;border-color:var(--teal)}
        .quote-actions{display:flex;gap:8px;padding:12px 0;align-items:center;flex-wrap:wrap}
        .btn-danger{background:var(--red-light);color:var(--red);border:1px solid rgba(217,68,82,.15)}

        /* Pricing history modal */
        .ph-summary{margin-top:10px;font-size:12px;color:var(--text2);padding:8px 10px;background:var(--surface);border-radius:6px}

        /* Log offer form */
        .lo-form{display:grid;grid-template-columns:1fr 1fr;gap:10px}
        .lo-form .field-full{grid-column:span 2}
        .lo-sources{display:flex;gap:10px;font-size:12px;align-items:center;padding:4px 0}
        .lo-sources label{display:flex;align-items:center;gap:4px;cursor:pointer;color:var(--text2)}
        .lo-sources input[type=radio]{accent-color:var(--teal)}

        /* Req card customer display */
        .req-customer{font-size:11px;color:var(--teal);font-weight:600}
        .req-status{display:inline-block;font-size:9px;font-weight:700;padding:1px 6px;border-radius:3px;text-transform:uppercase;letter-spacing:.3px;margin-left:4px}

        /* Customer site selector in new req modal */
        .site-typeahead{position:relative}
        .site-typeahead input{width:100%}
        .site-typeahead-list{position:absolute;top:100%;left:0;right:0;background:var(--white);border:1px solid var(--border);border-radius:6px;max-height:160px;overflow-y:auto;z-index:10;display:none;box-shadow:0 4px 16px rgba(0,0,0,.08)}
        .site-typeahead-list.show{display:block}
        .site-typeahead-item{padding:8px 10px;font-size:12px;cursor:pointer;transition:.1s}
        .site-typeahead-item:hover,.site-typeahead-item.active{background:var(--bg)}
        .ac-badge{font-size:9px;padding:1px 5px;border-radius:3px;margin-left:4px;text-transform:uppercase;letter-spacing:.3px;font-weight:600;opacity:.7}
        .ac-vendor{background:var(--teal-light,#e0f5f0);color:var(--teal,#0d9488)}
        .ac-customer{background:#f0e6ff;color:#6b3fa0}

        @media(max-width:768px){
            .dash-metrics{grid-template-columns:repeat(2,1fr)}
            .dash-grid{grid-template-columns:1fr}
            .lo-form{grid-template-columns:1fr}
            .lo-form .field-full{grid-column:span 1}
            .quote-totals{flex-direction:column;gap:8px}
            .quote-terms{flex-direction:column}
            .offer-group-header{flex-wrap:wrap}
            .si-contact-card{flex-wrap:wrap}
            .si-contact-actions{opacity:1;width:100%;justify-content:flex-end}
            .si-contact-meta a{max-width:none}
            /* CRM company cards */
            .cust-header{flex-wrap:wrap;gap:6px}
            .cust-header>span:last-child{width:100%;justify-content:flex-start}
            .cust-activity-section{padding:6px 0}
            .act-row{flex-wrap:wrap;gap:4px}
            .act-row-meta{font-size:9px}
            /* Vendor contacts in popup */
            #vpContactsList .si-contact{flex-direction:column;align-items:flex-start;gap:4px}
            #vpContactsList .si-contact-actions{width:100%;justify-content:flex-end}
        }

        /* Suggested Contacts */
        .sc-row{display:flex;gap:10px;align-items:flex-start;padding:8px 10px;border-bottom:1px solid var(--border);font-size:12px;cursor:pointer;transition:background .15s}
        .sc-row:hover{background:var(--surface)}
        .sc-row.selected{background:rgba(0,210,190,.08)}
        .sc-row input[type="checkbox"]{margin-top:3px;accent-color:var(--teal)}
        .sc-info{flex:1;min-width:0}
        .sc-name{font-weight:600;color:var(--text)}
        .sc-title{color:var(--text2);font-size:11px;margin-top:1px}
        .sc-meta{display:flex;gap:12px;margin-top:3px;font-size:11px;color:var(--muted)}
        .sc-meta a{color:var(--teal);text-decoration:none}
        .sc-meta a:hover{text-decoration:underline}
        .sc-badge{font-size:9px;padding:1px 6px;border-radius:8px;background:var(--bg2);color:var(--text2)}

        /* Enrichment info bar */
        .enrich-bar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;font-size:11px;color:var(--muted);margin-top:4px}
        .enrich-bar .enrich-tag{background:var(--bg2);padding:2px 8px;border-radius:8px;font-size:10px}
        .btn-enrich{font-size:11px;padding:3px 10px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--teal);cursor:pointer;transition:all .15s}
        .btn-enrich:hover{background:var(--teal);color:#fff;border-color:var(--teal)}

        /* ── AI Intelligence Layer ────────────────────────── */

        /* Confidence badges */
        .badge-green{background:var(--green-light);color:var(--green)}
        .badge-yellow{background:var(--amber-light);color:var(--amber)}
        .badge-gray{background:var(--bg2);color:var(--muted)}

        /* AI action buttons */
        .btn-ai{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:5px;font-size:11px;font-weight:700;background:linear-gradient(135deg,#f0e6ff,#e6f0ff);color:#6b46c1;border:1px solid rgba(107,70,193,.15);cursor:pointer;transition:.15s}
        .btn-ai:hover{background:linear-gradient(135deg,#e6d9ff,#d9e6ff);border-color:rgba(107,70,193,.3)}
        .btn-ai:disabled{opacity:.4;cursor:default}

        /* AI Contact Panel (modal overlay) */
        .ai-panel-bg{position:fixed;inset:0;background:rgba(0,0,0,.3);display:flex;align-items:center;justify-content:center;z-index:110;padding:20px;backdrop-filter:blur(3px)}
        .ai-panel{background:var(--white);border:1px solid var(--border);border-radius:14px;max-width:640px;width:100%;max-height:80vh;overflow-y:auto;padding:24px;box-shadow:0 12px 48px rgba(0,0,0,.1)}
        .ai-panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .ai-panel-header h3{font-size:15px;font-weight:800;margin:0}
        .btn-close-ai{background:none;border:none;font-size:18px;color:var(--muted);cursor:pointer;padding:4px 8px;border-radius:4px;transition:.15s}
        .btn-close-ai:hover{background:var(--bg);color:var(--text)}
        .ai-contact-row{display:flex;gap:10px;align-items:flex-start;padding:10px 0;border-bottom:1px solid var(--card2)}
        .ai-contact-row:last-child{border-bottom:none}
        .ai-contact-info{flex:1;min-width:0}
        .ai-contact-name{font-weight:700;font-size:13px}
        .ai-contact-title{color:var(--text2);font-size:11px;margin-top:1px}
        .ai-contact-meta{display:flex;gap:12px;margin-top:4px;font-size:11px;color:var(--muted);flex-wrap:wrap}
        .ai-contact-meta a{color:var(--teal);text-decoration:none}
        .ai-contact-meta a:hover{text-decoration:underline}
        .ai-contact-actions{display:flex;align-items:center;gap:6px;flex-shrink:0}

        /* Company Intel Card */
        .intel-card{margin-top:12px;border:1px solid var(--border);border-radius:8px;background:var(--surface);font-size:12px;overflow:hidden}
        .intel-card summary{padding:10px 14px;cursor:pointer;font-weight:700;font-size:12px;color:var(--teal);display:flex;align-items:center;gap:6px;user-select:none;transition:background .15s;list-style:none}
        .intel-card summary::-webkit-details-marker{display:none}
        .intel-card summary::before{content:'▸';font-size:10px;transition:transform .15s}
        .intel-card[open] summary::before{transform:rotate(90deg)}
        .intel-card summary:hover{background:var(--bg)}
        .intel-body{padding:10px 14px;border-top:1px solid var(--border)}
        .intel-summary{color:var(--text2);line-height:1.5;margin-bottom:8px}
        .intel-meta{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:8px;font-size:11px}
        .intel-meta-item{display:flex;gap:3px;align-items:center}
        .intel-meta-label{font-size:9px;text-transform:uppercase;color:var(--muted);font-weight:600;letter-spacing:.3px}
        .intel-tags{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px}
        .intel-tag{font-size:10px;padding:2px 8px;border-radius:4px;background:var(--teal-light);color:var(--teal);font-family:'JetBrains Mono',monospace}
        .intel-section{margin-top:8px}
        .intel-section-title{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:4px}
        .intel-signal{display:flex;align-items:flex-start;gap:4px;padding:3px 0;font-size:11px;color:var(--text2)}
        .intel-signal::before{content:'→';color:var(--green);font-weight:700;flex-shrink:0}
        .intel-source{font-size:10px;color:var(--muted);font-style:italic;margin-top:6px}

        /* Parse Preview Panel */
        .parse-preview{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:14px;margin-top:8px}
        .parse-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
        .parse-confidence{font-size:11px;font-weight:700;padding:2px 8px;border-radius:4px}
        .parse-conf-high{background:var(--green-light);color:var(--green)}
        .parse-conf-med{background:var(--amber-light);color:var(--amber)}
        .parse-conf-low{background:var(--red-light);color:var(--red)}
        .parse-classification{font-size:10px;font-weight:600;padding:2px 6px;border-radius:3px;background:var(--bg2);color:var(--text2);text-transform:uppercase;letter-spacing:.3px}
        .parse-parts-table{width:100%;font-size:11px;border-collapse:collapse;margin-top:8px}
        .parse-parts-table th{text-align:left;padding:4px 6px;color:var(--muted);font-weight:600;font-size:9px;text-transform:uppercase;border-bottom:1px solid var(--border)}
        .parse-parts-table td{padding:4px 6px;border-bottom:1px solid var(--card2);font-family:'JetBrains Mono',monospace}
        .parse-actions{display:flex;gap:6px;justify-content:flex-end;margin-top:10px}

        /* Engagement score ring in vendor popup */
        .engagement-ring{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;border:3px solid}
        .eng-high{border-color:var(--green);color:var(--green);background:var(--green-light)}
        .eng-med{border-color:var(--amber);color:var(--amber);background:var(--amber-light)}
        .eng-low{border-color:var(--red);color:var(--red);background:var(--red-light)}

        /* Toast container */
        #toastContainer{position:fixed;top:16px;right:16px;z-index:200;display:flex;flex-direction:column;gap:6px;pointer-events:none}
        #toastContainer > *{pointer-events:auto}

        @media(max-width:768px){
            .ai-panel-bg{padding:8px;align-items:flex-start;padding-top:40px}
            .ai-panel{padding:16px;max-height:calc(100vh - 60px)}
            .ai-contact-row{flex-direction:column;gap:6px}
            .ai-contact-actions{width:100%;justify-content:flex-end}
            .intel-meta{flex-direction:column;gap:4px}
        }

        /* Tablet breakpoint */
        @media(min-width:769px) and (max-width:1024px){
            .main{padding:16px}
            .lo-form{grid-template-columns:1fr 1fr}
            .src-grid{grid-template-columns:repeat(auto-fill,minmax(280px,1fr))}
            .cust-header>span:last-child{flex-wrap:wrap}
            .modal-lg{max-width:90%}
        }
        /* Utility classes */
        .flex{display:flex}.flex-center{display:flex;align-items:center}
        .gap-sm{gap:6px}.gap-md{gap:8px}.gap-lg{gap:10px}
        .flex-between{display:flex;justify-content:space-between;align-items:center}
        .flex-wrap{flex-wrap:wrap}
        .hidden{display:none!important}
        .text-muted{font-size:11px;color:var(--muted)}
        /* Performance Tracking */
        .perf-table{width:100%;border-collapse:collapse;font-size:12px}
        .perf-table th{text-align:left;padding:8px 10px;border-bottom:2px solid var(--border);font-size:11px;color:var(--muted);white-space:nowrap}
        .perf-table td{padding:8px 10px;border-bottom:1px solid var(--border)}
        .perf-table tr:hover{background:var(--surface)}
        .perf-table tr.cold-start{opacity:0.6}
        .perf-table tr.lb-highlight{background:rgba(61,104,149,0.08)}
        .perf-table tr.sc-gold{background:rgba(255,215,0,0.12)}
        .perf-table tr.sc-silver{background:rgba(192,192,192,0.15)}
        .perf-table th.sortable{cursor:pointer;user-select:none}
        .perf-table th.sortable:hover{color:var(--text)}
        .perf-table th.sorted-asc::after{content:" ▲";font-size:9px}
        .perf-table th.sorted-desc::after{content:" ▼";font-size:9px}
        .metric-cell{text-align:center;font-weight:600}
        .metric-cell.metric-green{color:#16a34a}
        .metric-cell.metric-yellow{color:#d97706}
        .metric-cell.metric-red{color:#dc2626}
        .metric-cell.na{color:var(--muted);font-weight:400;font-style:italic}
        .pts{font-size:10px;color:var(--muted);font-weight:400}
        .perf-summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-bottom:16px}
        .perf-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:14px 16px;text-align:center}
        .perf-card-num{font-size:22px;font-weight:700;color:var(--text)}
        .perf-card-label{font-size:11px;color:var(--muted);margin-top:4px}
        /* Settings Dropdown (inside sidebar) */
        .settings-dropdown{position:relative;display:inline-block}
        .settings-dropdown-content a{display:block;cursor:pointer;text-decoration:none;transition:background .1s}
        .settings-dropdown-content a:hover{background:rgba(255,255,255,.06) !important}
        .settings-panel{margin-top:12px}

        /* Email Threads */
        .email-thread-card{cursor:pointer;transition:border-color 0.15s}
        .email-thread-card:hover{border-color:var(--teal)}
        .email-thread-header{display:flex;justify-content:space-between;align-items:flex-start;gap:8px}
        .email-thread-subject{font-size:13px;font-weight:600;color:var(--text);flex:1}
        .email-thread-meta{display:flex;gap:8px;align-items:center;flex-shrink:0}
        .email-thread-count{font-size:11px;color:var(--muted);background:var(--surface);padding:1px 6px;border-radius:4px}
        .email-thread-date{font-size:11px;color:var(--muted)}
        .email-thread-participants{font-size:11px;color:var(--text2);margin-top:2px}
        .email-thread-snippet{font-size:11px;color:var(--muted);margin-top:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .email-needs-response{background:var(--amber-light);color:var(--amber);font-size:10px;padding:1px 6px;border-radius:4px;font-weight:600;margin-left:6px}
        .email-match-badge{background:var(--blue-light);color:var(--blue);font-size:9px;padding:1px 5px;border-radius:3px;margin-left:4px}
        .email-thread-messages{margin-top:10px;border-top:1px solid var(--border);padding-top:8px}
        .email-msg{padding:8px 12px;margin:4px 0;border-radius:8px;font-size:12px}
        .email-msg-sent{background:var(--blue-light);margin-left:20%}
        .email-msg-received{background:var(--surface);margin-right:20%}
        .email-msg-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
        .email-msg-header strong{font-size:12px;color:var(--text)}
        .email-msg-date{font-size:10px;color:var(--muted)}
        .email-msg-body{color:var(--text2);line-height:1.4;white-space:pre-wrap}
        .email-reply-area{margin-top:10px;padding:10px;background:var(--surface);border-radius:8px;border:1px solid var(--border)}
        .email-reply-input{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:12px;font-family:inherit;resize:vertical}
        .email-reply-input:focus{outline:none;border-color:var(--teal)}
        .spinner-row{display:flex;align-items:center;justify-content:center;gap:8px;padding:16px;color:var(--muted);font-size:12px}
        .spinner{width:16px;height:16px;border:2px solid var(--border);border-top-color:var(--teal);border-radius:50%;animation:spin 0.6s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}

        /* ── v7 Prototype Styles ────────────────────────────── */

        /* Top area — logo left, controls right, all on grey */
        .toparea{display:flex;align-items:center;gap:12px;padding:4px 16px;position:relative;z-index:100}
        .toparea img{height:72px;flex-shrink:0}
        .topcontrols{display:flex;align-items:center;gap:8px;flex:1;flex-wrap:wrap}

        /* Sidebar rail — blue tab centered on page with chevron */
        .sb-rail{position:fixed;top:50%;left:0;transform:translateY(-50%);height:160px;width:17px;background:var(--blue);z-index:201;cursor:pointer;transition:width .15s,background .15s,box-shadow .15s,opacity .2s;display:flex;align-items:center;justify-content:center;border-radius:0 6px 6px 0}
        .sb-rail:hover{width:22px;background:var(--blue-dk);box-shadow:2px 0 10px rgba(74,111,165,.3)}
        .sb-rail svg{width:12px;height:12px;fill:none;stroke:#fff;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round;opacity:.85;transition:opacity .15s}
        .sb-rail:hover svg{opacity:1}
        body.sb-open .sb-rail{opacity:0;pointer-events:none}

        /* v7 Sidebar overlay nav */
        .sidebar-nav{display:flex;flex-direction:column;gap:2px;padding:10px 8px;flex:1}
        .sidebar-nav button{display:flex;align-items:center;gap:10px;padding:11px 14px;border-radius:8px;border:none;background:transparent;color:var(--text2);font-size:13px;font-weight:600;cursor:pointer;transition:.15s;white-space:nowrap;text-align:left;font-family:inherit}
        .sidebar-nav button:hover{background:var(--surface);color:var(--text)}
        .sidebar-nav button.active{background:var(--teal-light);color:var(--teal)}
        .sidebar-nav .ni{font-size:18px;width:22px;text-align:center}
        .sidebar-nav .nav-logout{margin-top:auto;border-top:1px solid var(--border);border-radius:0 0 8px 8px;padding-top:12px;color:var(--muted)}
        .sidebar-nav .nav-logout:hover{color:var(--red);background:var(--red-light)}

        /* v7 Sidebar footer sub-elements */
        .sidebar-footer .ui{width:26px;height:26px;border-radius:50%;background:var(--teal);color:#fff;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;flex-shrink:0}
        .sidebar-footer .un{font-size:11px;color:var(--text2);font-weight:600;flex:1}
        .sidebar-footer .rb{font-size:9px;font-weight:700;padding:2px 5px;border-radius:3px;background:var(--teal-light);color:var(--teal)}
        .sidebar-footer .gb{border:none;background:none;cursor:pointer;color:var(--muted);font-size:14px}

        /* Body sidebar-open state */
        body.sb-open .sidebar{transform:translateX(0);border-right:3px solid var(--blue);box-shadow:3px 0 16px rgba(74,111,165,.18)}
        body.sb-open .main{margin-left:var(--sbw)}
        /* Click-away overlay to close sidebar */
        .sb-overlay{display:none;position:fixed;inset:0;z-index:149}
        body.sb-open .sb-overlay{display:block}

        /* Pills */
        .fpills{display:flex;gap:2px;background:var(--white);border-radius:8px;padding:3px;border:1px solid var(--border);box-shadow:0 1px 3px rgba(0,0,0,.04)}
        .fp{padding:5px 14px;border-radius:6px;border:none;background:transparent;color:var(--muted);font-size:12px;font-weight:600;cursor:pointer;transition:.15s;font-family:inherit}
        .fp.on{background:var(--teal);color:#fff}
        .fp:not(.on):hover{color:var(--text);background:var(--bg)}

        /* Search box — prominent */
        .sbox{background:var(--white);border:2px solid var(--teal);border-radius:8px;padding:6px 14px;font-size:13px;color:var(--text);width:280px;font-family:inherit;font-weight:500;box-shadow:0 0 0 3px rgba(74,111,165,.08)}
        .sbox:focus{outline:none;box-shadow:0 0 0 4px rgba(74,111,165,.18)}
        .sbox::placeholder{color:var(--muted)}

        /* Filter dropdown */
        .filter-wrap{position:relative}
        .filter-btn{display:flex;align-items:center;gap:5px;padding:8px 12px;border-radius:8px;border:1px solid var(--border);background:var(--white);font-size:12px;font-weight:600;color:var(--text2);cursor:pointer;font-family:inherit;transition:.15s}
        .filter-btn:hover{border-color:var(--teal);color:var(--teal)}
        .filter-btn.has-active{border-color:var(--teal);background:var(--teal-light);color:var(--teal)}
        .filter-badge{background:var(--teal);color:#fff;font-size:9px;font-weight:800;width:18px;height:18px;border-radius:50%;display:none;align-items:center;justify-content:center}
        .filter-btn.has-active .filter-badge{display:flex}
        .filter-panel{display:none;position:absolute;top:100%;left:0;margin-top:6px;background:var(--white);border:1px solid var(--border);border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.12);padding:12px;width:300px;z-index:300}
        .filter-panel.open{display:block}
        .filter-group{margin-bottom:10px}
        .filter-group:last-child{margin-bottom:0}
        .filter-group-title{font-size:10px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px}
        .filter-group label{display:flex;align-items:center;gap:6px;padding:3px 0;font-size:12px;color:var(--text2);cursor:pointer;font-weight:500}
        .filter-group input[type=checkbox]{accent-color:var(--teal);width:14px;height:14px;cursor:pointer}
        .filter-actions{display:flex;justify-content:flex-end;gap:6px;margin-top:8px;padding-top:8px;border-top:1px solid var(--card2)}
        .filter-actions button{padding:4px 10px;border-radius:5px;font-size:11px;font-weight:700;cursor:pointer;font-family:inherit;border:none}
        .fa-clear{background:transparent;color:var(--red)}.fa-clear:hover{text-decoration:underline}
        .fa-apply{background:var(--teal);color:#fff}

        /* v7 Button variants */
        .btn-p{background:var(--teal);color:#fff}.btn-p:hover{background:#3a5c8a}
        .btn-g{background:var(--green);color:#fff}.btn-g:hover{background:#0d8f6d}

        /* Expand arrow + detail rows */
        .ea{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:4px;cursor:pointer;transition:transform .15s;font-size:10px;color:var(--muted);border:1px solid var(--border);background:var(--white)}
        .ea:hover{background:var(--surface);color:var(--text)}.ea.open{transform:rotate(90deg)}
        .drow{display:none}.drow.open{display:table-row}
        .drow>td{padding:8px 12px 14px;background:var(--surface)!important;border:1px solid var(--border)!important;border-radius:0 0 6px 6px!important}
        .dtbl{width:100%;font-size:11px;border-collapse:collapse;margin-top:4px}
        .dtbl th{text-align:left;padding:4px 8px;color:var(--text);font-weight:700;font-size:10px;text-transform:uppercase;border-bottom:1px solid var(--border);background:transparent}
        .dtbl td{padding:4px 8px;border-bottom:1px solid var(--card2)}
        .dtbl input{border:1px solid var(--border);border-radius:4px;padding:3px 6px;font-size:11px;font-family:'JetBrains Mono',monospace;width:100%;background:var(--white)}
        .dtbl input:focus{outline:none;border-color:var(--teal)}

        /* Deadline flags */
        .dl{font-size:11px;font-weight:700;display:inline-flex;align-items:center;gap:3px}
        .dl-ok{color:var(--green)}.dl-w{color:var(--amber)}.dl-u{color:var(--red);animation:pulse 1.5s infinite}.dl-asap{color:var(--red);font-weight:800}

        /* Vendor drill-down */
        .vhdr{display:flex;align-items:center;gap:8px;margin-bottom:6px;flex-wrap:wrap}
        .vsrch{border:1px solid var(--border);border-radius:5px;padding:4px 8px;font-size:11px;font-family:inherit;width:180px;background:var(--white)}.vsrch:focus{outline:none;border-color:var(--teal)}
        .vflt{background:var(--white);border:1px solid var(--border);border-radius:5px;padding:4px 8px;font-size:10px;color:var(--text2);font-family:inherit;cursor:pointer}
        .clr{font-size:10px;color:var(--red);cursor:pointer;border:none;background:none;font-weight:700;font-family:inherit;padding:2px 6px}.clr:hover{text-decoration:underline}
        .vrow{display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid var(--card2)}.vrow:last-child{border-bottom:none}
        .vrow input[type=checkbox]{accent-color:var(--teal);width:15px;height:15px;cursor:pointer}
        .vn{font-weight:600;min-width:150px;font-size:12px}
        .vs{font-size:10px;font-weight:700;padding:1px 6px;border-radius:3px}
        .vs-h{background:var(--green-light);color:var(--green)}.vs-m{background:var(--amber-light);color:var(--amber)}.vs-l{background:var(--red-light);color:var(--red)}
        .vm{font-size:10px;color:var(--muted)}

        /* Progress bars */
        .prog{display:flex;align-items:center;gap:6px}
        .prog-bar{width:60px;height:5px;border-radius:3px;background:var(--bg2);overflow:hidden}
        .prog-fill{height:100%;border-radius:3px;background:var(--teal)}
        .prog-txt{font-size:10px;color:var(--muted);font-family:'JetBrains Mono',monospace}

        /* v7 Badge variants */
        .b-draft{background:var(--bg2);color:var(--muted)}
        .b-off{background:var(--green-light);color:var(--green)}
        .b-qtd{background:var(--amber-light);color:var(--amber)}

        /* View toggle */
        .view{display:none}.view.on{display:block}
    </style>
</head>
<body>
{% if not logged_in %}
<div class="login">
    <div class="login-card">
        <img src="/static/avail_logo.png" alt="AVAIL" class="login-logo">
        <div class="login-divider"></div>
        <p class="sub">Trio Supply Chain Solutions</p>
        <a href="/auth/login" class="btn-ms">
            <svg width="18" height="18" viewBox="0 0 21 21"><rect x="1" y="1" width="9" height="9" fill="#f25022"/><rect x="11" y="1" width="9" height="9" fill="#7fba00"/><rect x="1" y="11" width="9" height="9" fill="#00a4ef"/><rect x="11" y="11" width="9" height="9" fill="#ffb900"/></svg>
            Sign in with Microsoft
        </a>
        <p class="ver">v{{ app_version }}</p>
    </div>
</div>
{% else %}
<!-- TOP AREA — logo on grey bg + controls inline to the right -->
<div class="toparea">
    <img src="/static/avail_logo.png" alt="AVAIL">
    <div class="topcontrols" id="topcontrols">
        <button class="btn btn-primary" onclick="openNewReqModal()">+ New RFQ</button>
        <div class="fpills" id="mainPills">
            <button class="fp on" data-view="rfq" onclick="setMainView('rfq',this)">RFQ</button>
            <button class="fp" data-view="sourcing" onclick="setMainView('sourcing',this)">Sourcing</button>
            <button class="fp" data-view="archive" onclick="setMainView('archive',this)">Archive</button>
        </div>
        <input type="text" class="sbox" id="mainSearch" placeholder="&#x1f50d;  Search customer, part, RFQ&hellip;" oninput="debouncedMainSearch()">
        <div class="filter-wrap">
            <button class="filter-btn" onclick="toggleFilter('mainFilterPanel')">&#x23f7; Filters <span class="filter-badge" id="filterBadge">0</span></button>
            <div class="filter-panel" id="mainFilterPanel">
                <div id="filterGroups"></div>
                <div class="filter-actions">
                    <button class="fa-clear" onclick="clearAllFilters()">Clear all</button>
                    <button class="fa-apply" onclick="applyFilters()">Apply</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sidebar rail — blue strip with chevron, hover to open -->
<div class="sb-rail" onmouseenter="openSidebar()" title="Open menu" aria-label="Open sidebar">
    <svg viewBox="0 0 10 14"><polyline points="2,2 8,7 2,12"/></svg>
</div>

<!-- Mobile top bar -->
<div class="mobile-topbar">
    <button class="hamburger" onclick="toggleMobileSidebar()">&#9776;</button>
    <img src="/static/avail_logo.png" alt="AVAIL" class="mobile-logo">
</div>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleMobileSidebar()"></div>

<!-- Click-away overlay to close sidebar -->
<div class="sb-overlay" onmouseenter="closeSidebar()"></div>

<!-- SIDEBAR — v7 slide-out -->
<aside class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation" onmouseleave="closeSidebar()">
    <nav class="sidebar-nav">
        <button class="active" id="navReqs" onclick="sidebarNav('reqs',this)"><span class="ni">&#x1f4cb;</span> RFQs</button>
        <button id="navCustomers" onclick="sidebarNav('customers',this)"><span class="ni">&#x1f3e2;</span> Customers</button>
        <button id="navVendors" onclick="sidebarNav('vendors',this)"><span class="ni">&#x1f91d;</span> Vendors</button>
        <button id="navMaterials" onclick="sidebarNav('materials',this)"><span class="ni">&#x1f527;</span> Materials</button>
        <button id="navScorecards" onclick="sidebarNav('performance',this)"><span class="ni">&#x1f4ca;</span> Scorecards</button>
        <button id="navProactive" onclick="sidebarNav('proactive',this)" style="display:none"><span class="ni">&#x2b50;</span> Proactive</button>
        <button class="nav-logout" onclick="fetch('/auth/logout',{method:'POST'}).then(()=>location.reload())"><span class="ni">&#x1f6aa;</span> Logout</button>
    </nav>
    <div class="sidebar-footer">
        <span class="ui">{{ user_name[:2]|upper if user_name else 'U' }}</span>
        <span class="un">{{ user_name }}</span>
        <span id="roleBadge" style="display:none"></span>
        {% if is_admin %}<span class="rb">Admin</span>{% endif %}
        <button class="gb" id="settingsMenu" onclick="toggleSettingsDropdown()" title="Settings" style="display:none">&#x2699;</button>
        <div class="settings-dropdown-content" id="settingsDropdownContent" style="display:none;margin-top:4px;background:var(--white);border:1px solid var(--border);border-radius:6px">
            <a onclick="openSettingsTab('users')" style="color:var(--text2);padding:8px 12px;font-size:11px;display:block;cursor:pointer">Users</a>
            <a onclick="openSettingsTab('health')" style="color:var(--text2);padding:8px 12px;font-size:11px;display:block;cursor:pointer">System Health</a>
            <a onclick="openSettingsTab('scoring')" style="color:var(--text2);padding:8px 12px;font-size:11px;display:block;cursor:pointer">Scoring Weights</a>
            <a onclick="openSettingsTab('config')" style="color:var(--text2);padding:8px 12px;font-size:11px;display:block;cursor:pointer">Configuration</a>
            <a onclick="openSettingsTab('sources')" style="color:var(--text2);padding:8px 12px;font-size:11px;display:block;cursor:pointer">Data Sources</a>
            <a onclick="openSettingsTab('enrichment')" style="color:var(--text2);padding:8px 12px;font-size:11px;display:block;cursor:pointer">Enrichment</a>
            <a onclick="openSettingsTab('create-user')" style="color:var(--text2);padding:8px 12px;font-size:11px;display:block;cursor:pointer">Create User</a>
        </div>
        <span id="m365Status" style="display:none;font-size:10px;padding:4px 8px"><span id="m365Dot"></span><span id="m365Label"></span></span>
    </div>
</aside>

<!-- Main content -->
<div class="main">
    <div class="main-scroll">

    <!-- VIEW: Requisition List (v7 — header/tabs/filters are in toparea) -->
    <div id="view-list">
        <div id="reqList"><p class="empty">Loading…</p></div>
    </div>

    <!-- VIEW: Requisition Detail -->
    <div id="view-detail" style="display:none">
        <div class="detail-header">
            <div>
                <a class="back-link" onclick="showList()">← Back</a>
                <div style="display:flex;align-items:center;gap:8px"><h2 id="detailTitle" onclick="editReqName(this)" title="Click to rename" style="cursor:pointer"></h2><span id="detailStatus" class="status-chip"></span></div>
                <span id="detailCustomer" class="req-customer" onclick="openDetailSitePicker()" title="Click to link/change customer" style="cursor:pointer"></span>
                <div id="detailSitePicker" style="display:none;margin-top:4px">
                    <div class="site-typeahead" style="max-width:320px">
                        <input id="detailSiteSearch" placeholder="Search customer site…" autocomplete="off" oninput="filterDetailSiteTypeahead(this.value)">
                        <div class="site-typeahead-list" id="detailSiteList"></div>
                    </div>
                </div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
                <button class="btn btn-ghost btn-sm" id="cloneBtn" onclick="cloneRequisition(currentReqId)" title="Clone this requisition" style="display:none">Clone</button>
                <button class="btn btn-primary" id="searchAllBtn" onclick="submitOrSearch()">Search Selected</button>
            </div>
        </div>

        <div class="tabs" id="reqTabs">
            <button class="tab on" onclick="switchTab('requirements',this)">Requirements</button>
            <button class="tab" onclick="switchTab('sources',this)">Sources</button>
            <button class="tab" onclick="switchTab('activity',this)">Activity</button>
            <button class="tab" onclick="switchTab('offers',this)">Offers</button>
            <button class="tab" onclick="switchTab('quote',this)">Quote</button>
            <button class="tab" onclick="switchTab('emails',this)">Emails</button>
        </div>

        <!-- Requirements Tab -->
        <div id="tab-requirements" class="tc on">
            <div class="card" style="margin-bottom:12px">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                    <strong style="font-size:12px;color:var(--muted)">Type a part number and press Enter to add</strong>
                    <button class="btn btn-ghost btn-sm" onclick="toggleUpload()">📁 Upload CSV</button>
                </div>
                <div id="uploadArea" style="display:none;margin-bottom:12px">
                    <div class="uzone" id="dropZone" onclick="document.getElementById('fileInput').click()">
                        <input type="file" id="fileInput" accept=".csv,.xlsx,.xls,.tsv" onchange="showFileReady('fileInput','uploadReady','uploadFileName')">
                        <div class="uzone-label">Drop a file or click to browse</div>
                        <div class="uzone-hint">CSV or XLSX — columns: mpn (or part_number), qty, substitutes (or sub_1…sub_20)</div>
                    </div>
                    <div id="uploadReady" style="display:none;margin-bottom:8px">
                        <div style="display:flex;gap:8px;align-items:center">
                            <span style="font-size:12px;color:var(--text2)">📄 <span id="uploadFileName"></span></span>
                            <button class="btn btn-primary btn-sm" onclick="doUpload()">Upload</button>
                            <button class="btn btn-ghost btn-sm" onclick="clearFileInput('fileInput','uploadReady')">Cancel</button>
                        </div>
                    </div>
                    <div id="uploadStatus" class="ustatus"></div>
                </div>
                <div class="filter-bar" id="reqFilterBar" style="display:none">
                    <input type="text" class="filter-search" id="reqFilter" placeholder="Filter parts…" oninput="debouncedRenderReqTable()">
                    <div class="filter-pills">
                        <button class="filter-pill on" data-req-filter="all" onclick="setReqFilter('all',this)">All</button>
                        <button class="filter-pill" data-req-filter="nosrc" onclick="setReqFilter('nosrc',this)">No Sources</button>
                        <button class="filter-pill" data-req-filter="hassubs" onclick="setReqFilter('hassubs',this)">Has Subs</button>
                    </div>
                    <select class="filter-sort" id="reqSort" onchange="renderRequirementsTable()">
                        <option value="default">Default order</option>
                        <option value="mpn-asc">MPN A→Z</option>
                        <option value="mpn-desc">MPN Z→A</option>
                        <option value="qty-desc">Qty High→Low</option>
                        <option value="qty-asc">Qty Low→High</option>
                        <option value="src-desc">Sources High→Low</option>
                        <option value="src-asc">Sources Low→High</option>
                    </select>
                    <span class="filter-count" id="reqFilterCount"></span>
                </div>
                <table class="tbl">
                    <thead><tr><th style="width:28px"><input type="checkbox" checked onchange="toggleAllReqSelection(this.checked)" title="Select/deselect all"></th><th>Part Number</th><th style="width:50px">Qty</th><th>Substitutes</th><th style="width:64px">Target $</th><th style="width:60px">FW</th><th style="width:60px">DC</th><th style="width:60px">HW</th><th style="width:55px">Pkg</th><th style="width:55px">Cond</th><th style="width:45px">Src</th><th style="width:30px"></th></tr></thead>
                    <tbody id="reqTable"></tbody>
                    <tfoot>
                        <tr class="add-row">
                            <td></td>
                            <td><input id="fMpn" placeholder="Enter part number…" onkeydown="if(event.key==='Enter')addReq()"></td>
                            <td><input id="fQty" type="number" value="1" min="1" style="width:50px" onkeydown="if(event.key==='Enter')addReq()"></td>
                            <td><input id="fSubs" placeholder="Alternates…" onkeydown="if(event.key==='Enter')addReq()"></td>
                            <td><input id="fTarget" type="number" step="0.01" min="0" placeholder="—" style="width:60px" onkeydown="if(event.key==='Enter')addReq()"></td>
                            <td colspan="5"></td>
                            <td></td>
                            <td><button class="btn btn-primary btn-sm" onclick="addReq()" title="Add">+</button></td>
                        </tr>
                    </tfoot>
                </table>
                <div id="searchAllBar" class="search-all-bar" onclick="submitOrSearch()" style="display:none">
                    <span class="search-all-bar-text" id="searchAllBarText">Search selected parts</span>
                </div>
            </div>
        </div>

        <!-- Sources Tab -->
        <div id="tab-sources" class="tc">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                <strong style="font-size:13px">Search Results</strong>
                <div style="display:flex;gap:6px">
                    <button class="btn btn-ghost btn-sm" onclick="expandAllGroups()">Expand All</button>
                    <button class="btn btn-ghost btn-sm" onclick="collapseAllGroups()">Collapse All</button>
                    <span style="width:1px;background:var(--border);margin:0 2px"></span>
                    <button class="btn btn-ghost btn-sm" data-role="buyer" onclick="selectAllSightings()">Select All</button>
                    <button class="btn btn-ghost btn-sm" data-role="buyer" onclick="clearSelection()">Clear</button>
                    <button class="btn btn-success btn-sm" id="batchRfqBtn" data-role="buyer" disabled onclick="openBatchRfqModal()">Send Batch RFQ (0)</button>
                </div>
            </div>
            <div class="filter-bar" id="srcFilterBar">
                <input type="text" class="filter-search" id="srcFilter" placeholder="Search vendor, MPN, manufacturer…" oninput="debouncedRenderSources()" aria-label="Filter search results">
                <div class="filter-pills">
                    <button class="filter-pill on" data-src-filter="all" onclick="setSrcFilter('all',this)">All</button>
                    <button class="filter-pill" data-src-filter="exact" onclick="setSrcFilter('exact',this)">Exact</button>
                    <button class="filter-pill" data-src-filter="sub" onclick="setSrcFilter('sub',this)">Subs</button>
                    <button class="filter-pill" data-src-filter="available" onclick="setSrcFilter('available',this)">Available</button>
                    <button class="filter-pill" data-src-filter="sold" onclick="setSrcFilter('sold',this)">Not Available</button>
                </div>
                <select class="filter-sort" id="srcSort" onchange="setSrcSort(this.value)">
                    <option value="default">Default (score)</option>
                    <option value="price-asc">Price Low→High</option>
                    <option value="price-desc">Price High→Low</option>
                    <option value="qty-desc">Qty High→Low</option>
                    <option value="qty-asc">Qty Low→High</option>
                    <option value="vendor-az">Vendor A→Z</option>
                    <option value="engagement">Engagement High→Low</option>
                </select>
                <span class="filter-count" id="srcFilterCount"></span>
            </div>
            <div class="collapsed-match-hint hidden" id="collapsedMatchHint"></div>
            <div id="sourceResults"><p class="empty">Search requirements to see vendor results</p></div>
        </div>

        <!-- Activity Tab -->
        <div id="tab-activity" class="tc">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                <strong style="font-size:13px">Contact Activity</strong>
                <span style="font-size:10px;color:var(--muted)">Inbox checked automatically every 30 min</span>
            </div>
            <div class="act-summary" id="actSummary" style="display:none">
                <div class="act-stat act-stat-sent" data-act-stat="all" onclick="setActStat('all',this)">
                    <div class="act-stat-num" id="actStatSent">0</div>
                    <div class="act-stat-label">✉ Sent</div>
                </div>
                <div class="act-stat act-stat-replied" data-act-stat="replied" onclick="setActStat('replied',this)">
                    <div class="act-stat-num" id="actStatReplied">0</div>
                    <div class="act-stat-label">✅ Replied</div>
                </div>
                <div class="act-stat act-stat-opened" data-act-stat="opened" onclick="setActStat('opened',this)">
                    <div class="act-stat-num" id="actStatOpened">0</div>
                    <div class="act-stat-label">👁 Opened</div>
                </div>
                <div class="act-stat act-stat-awaiting" data-act-stat="awaiting" onclick="setActStat('awaiting',this)">
                    <div class="act-stat-num" id="actStatAwaiting">0</div>
                    <div class="act-stat-label">⏳ Awaiting</div>
                </div>
            </div>
            <div class="filter-bar" id="actFilterBar" style="display:none">
                <input type="text" class="filter-search" id="actFilter" placeholder="Search vendor, contact, part…" oninput="debouncedRenderActivity()">
                <div class="filter-pills">
                    <button class="filter-pill on" data-act-filter="all" onclick="setActFilter('all',this)">All</button>
                    <button class="filter-pill" data-act-filter="email" onclick="setActFilter('email',this)">✉ Email</button>
                    <button class="filter-pill" data-act-filter="phone" onclick="setActFilter('phone',this)">📞 Phone</button>
                </div>
                <select class="filter-sort" id="actSort" onchange="renderActivityCards()">
                    <option value="date-desc">Newest first</option>
                    <option value="date-asc">Oldest first</option>
                    <option value="vendor-asc">Vendor A→Z</option>
                    <option value="vendor-desc">Vendor Z→A</option>
                    <option value="status">Status</option>
                </select>
                <span class="filter-count" id="actFilterCount"></span>
            </div>
            <div id="activityLog"><p class="empty">No activity yet</p></div>
        </div>

        <!-- Offers Tab -->
        <div id="tab-offers" class="tc">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                <strong style="font-size:13px">Vendor Offers</strong>
                <div style="display:flex;gap:6px">
                    <button class="btn btn-ghost btn-sm" onclick="openLogOfferModal()">+ Log Offer</button>
                    <button class="btn btn-primary btn-sm" id="buildQuoteBtn" disabled onclick="buildQuoteFromSelected()">Build Quote from Selected (0)</button>
                </div>
            </div>
            <div id="offersContent"><p class="empty">No offers yet — log vendor offers as they come in</p></div>
        </div>

        <!-- Quote Tab -->
        <div id="tab-quote" class="tc">
            <div id="quoteContent"><p class="empty">No quote yet — select offers on the Offers tab and click "Build Quote"</p></div>
        </div>

        <!-- Emails Tab -->
        <div id="tab-emails" class="tc">
            <div id="emailsContent">
                <p class="empty">Loading email threads...</p>
            </div>
        </div>
    </div>

    <!-- VIEW: Customers -->
    <div id="view-customers" style="display:none">
        <div class="req-header">
            <h2>Customers</h2>
            <div class="flex-center gap-lg">
                <input class="req-search" id="custFilter" placeholder="Search companies…" oninput="debouncedLoadCustomers()" aria-label="Search companies">
                <button class="btn btn-primary" onclick="openNewCompanyModal()">+ New Company</button>
            </div>
        </div>
        <div class="cust-filters flex-center gap-sm flex-wrap" style="padding:0 16px 8px">
            <button class="filter-pill" id="custUnassignedPill" onclick="toggleCustUnassigned(this)">Unassigned</button>
            <label id="custMyOnlyLabel" class="flex-center" style="gap:5px;font-size:12px;color:var(--text2);cursor:pointer;display:none">
                <input type="checkbox" id="custMyOnly" onchange="loadCustomers()" style="accent-color:var(--teal)" aria-label="Show only my accounts"> My accounts
            </label>
            <select class="filter-sort" id="custSort" onchange="sortCustomers(this.value)">
                <option value="name-az">Name A→Z</option>
                <option value="name-za">Name Z→A</option>
                <option value="sites">Most Sites</option>
                <option value="type">Account Type</option>
            </select>
            <span id="custFilterCount" class="text-muted" style="font-size:11px"></span>
        </div>
        <div id="custList"><p class="empty">Loading…</p></div>
    </div>

    <!-- VIEW: Vendors -->
    <div id="view-vendors" style="display:none">
        <div class="vendor-header">
            <h2>Vendor Directory</h2>
        </div>
        <!-- Tier tabs -->
        <div class="tabs" id="vendorTierTabs" style="margin-bottom:12px">
            <button class="tab on" onclick="setVendorTier('all',this)">All</button>
            <button class="tab" onclick="setVendorTier('proven',this)">Proven</button>
            <button class="tab" onclick="setVendorTier('developing',this)">Developing</button>
            <button class="tab" onclick="setVendorTier('caution',this)">Caution</button>
            <button class="tab" onclick="setVendorTier('new',this)">New</button>
        </div>
        <!-- Filter bar -->
        <div class="filter-bar" style="margin-bottom:8px">
            <input class="filter-search" id="vendorSearch" placeholder="Search vendors…" oninput="debouncedFilterVendors()" aria-label="Search vendors">
            <label style="font-size:11px;color:var(--muted);cursor:pointer;display:flex;align-items:center;gap:4px">
                <input type="checkbox" id="vendorHideBL" onchange="filterVendorList()" aria-label="Hide blacklisted vendors"> Hide blacklisted
            </label>
            <select class="filter-sort" id="vendorSort" onchange="setVendorSort(this.value)">
                <option value="name-az">Name A→Z</option>
                <option value="name-za">Name Z→A</option>
                <option value="eng-desc">Engagement High→Low</option>
                <option value="eng-asc">Engagement Low→High</option>
                <option value="sightings">Most sightings</option>
                <option value="rating">Highest rated</option>
            </select>
            <span id="vendorFilterCount" class="text-muted"></span>
        </div>
        <div id="vendorList"><p class="empty">Loading…</p></div>
    </div>

    <!-- VIEW: Materials -->
    <div id="view-materials" style="display:none">
        <div class="vendor-header">
            <h2>Materials</h2>
        </div>
        <!-- Search-first layout -->
        <div class="filter-bar" style="margin-bottom:8px">
            <input class="filter-search" id="materialSearch" placeholder="Search by part number or manufacturer…" oninput="debouncedLoadMaterials()" aria-label="Search material cards" style="flex:2;max-width:480px">
            <select class="filter-sort" id="materialSort" onchange="setMaterialSort(this.value)">
                <option value="last-searched">Last searched</option>
                <option value="mpn-az">MPN A→Z</option>
                <option value="mpn-za">MPN Z→A</option>
                <option value="most-searched">Most searched</option>
                <option value="most-vendors">Most vendors</option>
                <option value="oldest-search">Oldest search</option>
            </select>
            <button class="btn btn-ghost btn-sm" onclick="toggleStockImport()">Import Stock</button>
        </div>
        <div id="stockImportArea" data-role="buyer" style="display:none;margin-bottom:12px" class="card">
            <strong style="font-size:12px;color:var(--muted)">Import a vendor stock list — all rows stored as material cards with vendor history</strong>
            <div style="display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap">
                <div class="site-typeahead" style="flex:1;min-width:150px"><input id="stockVendorName" placeholder="Vendor name (required)…" required aria-label="Vendor name for stock import" autocomplete="off" style="width:100%;padding:6px 10px;border:1px solid var(--border);border-radius:6px;background:var(--surface);color:var(--text)"><div class="site-typeahead-list" id="stockVendorNameList"></div></div>
                <input id="stockVendorWebsite" placeholder="Website (for new vendor)" class="ac-website-inline" style="display:none;flex:0 0 180px;padding:6px 10px;border:1px solid var(--border);border-radius:6px;background:var(--surface);color:var(--text);font-size:12px">
                <input type="file" id="stockFileInput" accept=".csv,.xlsx,.xls,.tsv" style="display:none" onchange="showFileReady('stockFileInput','stockFileReady','stockFileName')">
                <button class="btn btn-ghost btn-sm" onclick="document.getElementById('stockFileInput').click()">Choose File</button>
            </div>
            <div id="stockFileReady" style="display:none;margin-top:8px">
                <div style="display:flex;gap:8px;align-items:center">
                    <span style="font-size:12px;color:var(--text2)">📄 <span id="stockFileName"></span></span>
                    <button class="btn btn-primary btn-sm" onclick="doStockImport()">Import</button>
                    <button class="btn btn-ghost btn-sm" onclick="clearFileInput('stockFileInput','stockFileReady')">Cancel</button>
                </div>
            </div>
            <div class="uzone-hint" style="margin-top:4px">CSV/XLSX — columns: mpn (or part_number), qty, price, manufacturer</div>
            <div id="stockImportStatus" class="ustatus"></div>
        </div>
        <div id="materialList"><p class="empty">Loading…</p></div>
    </div>

    <!-- VIEW: Buy Plans (admin only) -->
    <div id="view-buyplans" style="display:none">
        <div class="vendor-header">
            <h2>Buy Plans</h2>
            <div style="display:flex;gap:6px">
                <button class="filter-pill on" data-bp-status="" onclick="setBpFilter('',this)">All</button>
                <button class="filter-pill" data-bp-status="pending_approval" onclick="setBpFilter('pending_approval',this)">Pending</button>
                <button class="filter-pill" data-bp-status="approved" onclick="setBpFilter('approved',this)">Approved</button>
                <button class="filter-pill" data-bp-status="po_entered" onclick="setBpFilter('po_entered',this)">PO Entered</button>
                <button class="filter-pill" data-bp-status="po_confirmed" onclick="setBpFilter('po_confirmed',this)">Confirmed</button>
                <button class="filter-pill" data-bp-status="complete" onclick="setBpFilter('complete',this)">Complete</button>
                <button class="filter-pill" data-bp-status="cancelled" onclick="setBpFilter('cancelled',this)">Cancelled</button>
            </div>
        </div>
        <div id="buyPlansList"><p class="empty">Loading…</p></div>
    </div>

    <!-- VIEW: Proactive Offers -->
    <div id="view-proactive" style="display:none">
        <div class="vendor-header">
            <h2>Proactive Offers</h2>
        </div>
        <div class="tabs" id="proactiveTabs">
            <button class="tab on" onclick="switchProactiveTab('matches',this)">Matches</button>
            <button class="tab" onclick="switchProactiveTab('sent',this)">Sent</button>
            <button class="tab" onclick="switchProactiveTab('scorecard',this)">Scorecard</button>
        </div>
        <div id="proactiveMatchesPanel"><p class="empty">Loading…</p></div>
        <div id="proactiveSentPanel" style="display:none"><p class="empty">Loading…</p></div>
        <div id="proactiveScorecardPanel" style="display:none"><p class="empty">Loading…</p></div>
    </div>
    </div><!-- /.main -->
</div><!-- /.shell -->

<!-- New Requisition Modal -->
<div id="newReqModal" class="modal-bg" onclick="if(event.target===this)closeModal('newReqModal')">
    <div class="modal">
        <h2>New Requisition</h2>
        <div class="field"><label for="nrName">Name <span style="color:var(--red)">*</span></label><input id="nrName" placeholder="e.g. Siemens Medical - Feb 2026" onkeydown="if(event.key==='Enter')createRequisition()" required></div>
        <div class="field" style="margin-top:10px">
            <label>Customer Account <span style="color:var(--red)">*</span></label>
            <div class="site-typeahead">
                <input id="nrSiteSearch" placeholder="Type to search companies…" oninput="debouncedFilterSites(this.value)" onfocus="filterSiteTypeahead(this.value)" autocomplete="off" aria-label="Search customer sites">
                <input type="hidden" id="nrSiteId">
                <div class="site-typeahead-list" id="nrSiteList"></div>
            </div>
            <div id="nrSiteSelected" style="display:none;margin-top:6px;padding:8px 12px;background:var(--teal-light);border:1px solid rgba(61,104,149,.15);border-radius:6px;font-size:12px;display:none">
                <span id="nrSiteSelectedLabel" style="font-weight:600"></span>
                <span onclick="clearNrSite()" style="margin-left:8px;color:var(--red);cursor:pointer;font-size:11px">Clear</span>
            </div>
        </div>
        <div class="field" id="nrContactField" style="margin-top:10px;display:none">
            <label>Requesting Contact</label>
            <select id="nrContactSelect" style="width:100%;padding:8px 10px;border:1px solid var(--border);border-radius:6px;font-size:12px;background:var(--white);color:var(--text)">
                <option value="">— Select contact —</option>
            </select>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('newReqModal')">Cancel</button>
            <button class="btn btn-primary" onclick="createRequisition()">Create</button>
        </div>
    </div>
</div>

<!-- Batch RFQ Modal -->
<div id="rfqModal" class="modal-bg" onclick="if(event.target===this)closeModal('rfqModal')">
    <div class="modal modal-lg">
        <h2>Send Batch RFQ</h2>
        <div id="rfqPrepare">
            <p id="rfqPrepareStatus" style="font-size:12px;color:var(--text2);margin-bottom:12px">Checking vendor contacts…</p>
        </div>
        <div id="rfqReady" style="display:none">
            <p style="font-size:12px;color:var(--text2);margin-bottom:10px" id="rfqSummary"></p>
            <div style="display:flex;gap:8px;margin-bottom:8px">
                <button class="btn btn-ghost btn-sm" onclick="rfqSelectAllVendors()">Select All</button>
                <button class="btn btn-ghost btn-sm" onclick="rfqDeselectAllVendors()">Deselect All</button>
            </div>
            <div id="rfqVendorList" style="max-height:240px;overflow-y:auto;margin-bottom:12px"></div>
            <div class="rfq-condition">
                <label>Condition Required</label>
                <button class="rfq-cond-btn active" onclick="setRfqCondition('any',this)">Any</button>
                <button class="rfq-cond-btn" onclick="setRfqCondition('new',this)">New</button>
                <button class="rfq-cond-btn" onclick="setRfqCondition('used',this)">Used</button>
            </div>
            <div class="field"><label>Subject</label><input id="rfqSubject"></div>
            <div class="field">
                <label>Message</label>
                <textarea id="rfqBody" style="min-height:160px"></textarea>
            </div>
            <div class="mactions">
                <button class="btn btn-ghost" onclick="closeModal('rfqModal')">Cancel</button>
                <button class="btn btn-success" id="rfqSendBtn" onclick="sendBatchRfq()">Send</button>
            </div>
        </div>
    </div>
</div>

<!-- Vendor Card Popup -->
<div id="vendorPopup" class="modal-bg" onclick="if(event.target===this)closeModal('vendorPopup')">
    <div class="modal modal-lg">
        <div id="vendorPopupContent"><p class="empty">Loading…</p></div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('vendorPopup')">Close</button>
        </div>
    </div>
</div>

<!-- Vendor Contact Modal -->
<div id="vendorContactModal" class="modal-bg" onclick="if(event.target===this)closeModal('vendorContactModal')">
    <div class="modal">
        <h2 id="vendorContactModalTitle">Add Vendor Contact</h2>
        <input type="hidden" id="vcCardId">
        <input type="hidden" id="vcContactId">
        <div class="lo-form">
            <div class="field"><label for="vcEmail">Email *</label><input id="vcEmail" type="email" placeholder="email@vendor.com" required onkeydown="if(event.key==='Enter')saveVendorContact()"></div>
            <div class="field"><label for="vcFullName">Name</label><input id="vcFullName" placeholder="Full name"></div>
            <div class="field"><label for="vcTitle">Job Title</label><input id="vcTitle" placeholder="e.g. Sales Manager"></div>
            <div class="field"><label for="vcPhone">Phone</label><input id="vcPhone" type="tel" placeholder="+1 555-000-0000"></div>
            <div class="field"><label for="vcLabel">Label</label><input id="vcLabel" placeholder="Sales, Support, etc." value="Sales"></div>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('vendorContactModal')">Cancel</button>
            <button class="btn btn-primary" onclick="saveVendorContact()">Save Contact</button>
        </div>
    </div>
</div>

<!-- Vendor Log Call Modal -->
<div id="vendorLogCallModal" class="modal-bg" onclick="if(event.target===this)closeModal('vendorLogCallModal')">
    <div class="modal">
        <h2>Log Vendor Call &mdash; <span id="vlcVendorName"></span></h2>
        <input type="hidden" id="vlcCardId">
        <div class="lo-form">
            <div class="field"><label for="vlcPhone">Phone</label><input id="vlcPhone" type="tel" placeholder="+1 555-000-0000" onkeydown="if(event.key==='Enter')saveVendorLogCall()"></div>
            <div class="field"><label for="vlcContactName">Contact Name</label><input id="vlcContactName" placeholder="Who did you speak to?"></div>
            <div class="field"><label for="vlcDirection">Direction</label>
                <select id="vlcDirection" style="background:var(--input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;font-size:12px;width:100%">
                    <option value="outbound">Outbound</option>
                    <option value="inbound">Inbound</option>
                </select>
            </div>
            <div class="field"><label for="vlcDuration">Duration (seconds)</label><input id="vlcDuration" type="number" placeholder="120" min="0"></div>
            <div class="field"><label for="vlcNotes">Notes</label><textarea id="vlcNotes" rows="3" placeholder="Call summary..." style="width:100%;background:var(--input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;font-size:12px;resize:vertical"></textarea></div>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('vendorLogCallModal')">Cancel</button>
            <button class="btn btn-primary" onclick="saveVendorLogCall()">Log Call</button>
        </div>
    </div>
</div>

<!-- Vendor Log Note Modal -->
<div id="vendorLogNoteModal" class="modal-bg" onclick="if(event.target===this)closeModal('vendorLogNoteModal')">
    <div class="modal">
        <h2>Add Note &mdash; <span id="vlnVendorName"></span></h2>
        <input type="hidden" id="vlnCardId">
        <div class="lo-form">
            <div class="field"><label for="vlnContactName">Contact Name (optional)</label><input id="vlnContactName" placeholder="Related contact name"></div>
            <div class="field"><label for="vlnNotes">Note *</label><textarea id="vlnNotes" rows="4" placeholder="Enter note..." required style="width:100%;background:var(--input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;font-size:12px;resize:vertical"></textarea></div>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('vendorLogNoteModal')">Cancel</button>
            <button class="btn btn-primary" onclick="saveVendorLogNote()">Save Note</button>
        </div>
    </div>
</div>

<!-- Material Card Popup -->
<div id="materialPopup" class="modal-bg" onclick="if(event.target===this)closeModal('materialPopup')">
    <div class="modal modal-lg">
        <div id="materialPopupContent"><p class="empty">Loading…</p></div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('materialPopup')">Close</button>
        </div>
    </div>
</div>

<!-- New Company Modal -->
<div id="newCompanyModal" class="modal-bg" onclick="if(event.target===this)closeModal('newCompanyModal')">
    <div class="modal">
        <h2>New Company</h2>
        <div class="field"><label for="ncName">Company Name</label><div class="site-typeahead"><input id="ncName" placeholder="e.g. Siemens" required autocomplete="off" onkeydown="if(event.key==='Enter'&&!document.getElementById('ncNameList').classList.contains('show'))createCompany()"><div class="site-typeahead-list" id="ncNameList"></div></div></div>
        <div class="field"><label for="ncWebsite">Website</label><input id="ncWebsite" placeholder="siemens.com" type="url"></div>
        <div class="field"><label for="ncLinkedin">LinkedIn</label><input id="ncLinkedin" placeholder="linkedin.com/company/..." type="url"></div>
        <div class="field"><label for="ncIndustry">Industry</label><input id="ncIndustry" placeholder="Medical, Industrial, etc."></div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('newCompanyModal')">Cancel</button>
            <button class="btn btn-primary" onclick="createCompany()">Create &amp; Add Site</button>
        </div>
    </div>
</div>

<!-- Edit Company Modal -->
<div id="editCompanyModal" class="modal-bg" onclick="if(event.target===this)closeModal('editCompanyModal')">
    <div class="modal" style="max-width:560px">
        <input type="hidden" id="ecId">
        <h2>Edit Company</h2>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="field" style="grid-column:1/-1"><label>Company Name</label><input id="ecName"></div>
            <div class="field"><label>Account Type</label>
                <select id="ecAccountType" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:8px;font-size:12px">
                    <option value="">—</option>
                    <option>Customer</option><option>Prospect</option><option>Partner</option><option>Competitor</option>
                </select>
            </div>
            <div class="field"><label>Account Owner</label><select id="ecOwner" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:8px;font-size:12px"></select></div>
            <div class="field"><label>Phone</label><input id="ecPhone" placeholder="+1 (555) 000-0000"></div>
            <div class="field"><label>Website</label><input id="ecWebsite" placeholder="company.com"></div>
            <div class="field"><label>Domain</label><input id="ecDomain" placeholder="company.com"></div>
            <div class="field"><label>LinkedIn</label><input id="ecLinkedin" placeholder="linkedin.com/company/..."></div>
            <div class="field"><label>Industry</label><input id="ecIndustry"></div>
            <div class="field"><label>Legal Name</label><input id="ecLegalName"></div>
            <div class="field"><label>Employee Size</label><input id="ecEmployeeSize" placeholder="51-200"></div>
            <div class="field"><label>HQ City</label><input id="ecHqCity"></div>
            <div class="field"><label>HQ State</label><input id="ecHqState"></div>
            <div class="field"><label>HQ Country</label><input id="ecHqCountry"></div>
            <div class="field"><label>Credit Terms</label><input id="ecCreditTerms" placeholder="Net 30"></div>
            <div class="field"><label>Tax ID</label><input id="ecTaxId" placeholder="EIN / VAT"></div>
            <div class="field"><label>Currency</label><input id="ecCurrency" placeholder="USD" style="width:80px"></div>
            <div class="field"><label>Preferred Carrier</label><input id="ecCarrier" placeholder="FedEx, UPS..."></div>
            <div class="field" style="grid-column:1/-1"><label>Notes</label><textarea id="ecNotes" rows="2" style="width:100%"></textarea></div>
            <div class="field"><label style="display:flex;align-items:center;gap:6px"><input type="checkbox" id="ecStrategic"> Strategic Account</label></div>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('editCompanyModal')">Cancel</button>
            <button class="btn btn-primary" onclick="saveEditCompany()">Save</button>
        </div>
    </div>
</div>

<!-- Add Site Modal -->
<div id="addSiteModal" class="modal-bg" onclick="if(event.target===this)closeModal('addSiteModal')">
    <div class="modal">
        <input type="hidden" id="asSiteCompanyId">
        <h2>Add Site to <span id="asSiteCompanyName"></span></h2>
        <div class="lo-form">
            <div class="field"><label for="asSiteName">Site Name</label><input id="asSiteName" placeholder="HQ, West Coast, etc." required></div>
            <div class="field"><label for="asSiteOwner">Owner</label><select id="asSiteOwner"><option value="">— None —</option></select></div>
            <div class="field"><label for="asSiteAddr1">Address Line 1</label><input id="asSiteAddr1" placeholder="123 Main St"></div>
            <div class="field"><label for="asSiteAddr2">Address Line 2</label><input id="asSiteAddr2" placeholder="Suite 200"></div>
            <div style="display:flex;gap:8px">
                <div class="field" style="flex:2"><label for="asSiteCity">City</label><input id="asSiteCity" placeholder="Austin"></div>
                <div class="field" style="flex:1"><label for="asSiteState">State</label><input id="asSiteState" placeholder="TX"></div>
                <div class="field" style="flex:1"><label for="asSiteZip">Zip</label><input id="asSiteZip" placeholder="78701"></div>
            </div>
            <div class="field"><label for="asSiteCountry">Country</label><input id="asSiteCountry" placeholder="US" value="US"></div>
            <div class="field"><label for="asSitePayTerms">Payment Terms</label><input id="asSitePayTerms" placeholder="Net 30"></div>
            <div class="field"><label for="asSiteShipTerms">Shipping Terms</label><input id="asSiteShipTerms" placeholder="FOB Origin"></div>
            <div class="field"><label for="asSiteType">Site Type</label>
                <select id="asSiteType" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:8px;font-size:12px">
                    <option value="">—</option>
                    <option>HQ</option><option>Branch</option><option>Warehouse</option><option>Manufacturing</option>
                </select>
            </div>
            <div class="field"><label for="asSiteTimezone">Timezone</label><input id="asSiteTimezone" placeholder="America/New_York"></div>
            <div class="field"><label for="asSiteRecvHours">Receiving Hours</label><input id="asSiteRecvHours" placeholder="Mon-Fri 8am-5pm"></div>
            <div class="field"><label for="asSiteCarrierAcct">Carrier Account</label><input id="asSiteCarrierAcct" placeholder="UPS/FedEx acct #"></div>
            <div class="field"><label for="asSiteNotes">Notes</label><textarea id="asSiteNotes" rows="2" placeholder="Internal notes..." style="width:100%;resize:vertical"></textarea></div>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('addSiteModal')">Cancel</button>
            <button class="btn btn-primary" onclick="addSite()">Add Site</button>
        </div>
    </div>
</div>

<!-- Suggested Contacts Modal -->
<div id="suggestedContactsModal" class="modal-bg" onclick="if(event.target===this)closeModal('suggestedContactsModal')">
    <div class="modal modal-lg">
        <h2 id="scModalTitle">Suggested Contacts</h2>
        <p style="font-size:11px;color:var(--muted);margin-bottom:10px" id="scModalSubtitle">Select contacts to add</p>
        <div style="display:flex;gap:8px;margin-bottom:10px;align-items:center">
            <input class="req-search" id="scTitleFilter" placeholder="Filter by title (e.g. Sales, Procurement)…" style="flex:1"
                   onkeydown="if(event.key==='Enter')searchSuggestedContacts()">
            <button class="btn btn-ghost btn-sm" onclick="searchSuggestedContacts()">Search</button>
        </div>
        <div id="scResults" style="max-height:340px;overflow-y:auto;margin-bottom:12px">
            <p class="empty">Click Search or enter a title filter to find contacts</p>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('suggestedContactsModal')">Cancel</button>
            <button class="btn btn-primary" id="scAddBtn" onclick="addSelectedSuggestedContacts()" style="display:none">Add Selected (0)</button>
        </div>
    </div>
</div>

<!-- Log Offer Modal -->
<div id="logOfferModal" class="modal-bg" onclick="if(event.target===this)closeModal('logOfferModal')">
    <div class="modal modal-lg">
        <h2>Log Vendor Offer</h2>
        <div class="lo-form">
            <div class="field field-full"><label>Part Number</label><select id="loMpn" style="padding:8px 10px;border:1px solid var(--border);border-radius:6px;background:var(--input);font-size:12px"></select></div>
            <div class="field field-full"><label>Vendor Name</label><select id="loVendor" style="padding:8px 10px;border:1px solid var(--border);border-radius:6px;background:var(--input);font-size:12px"><option value="">Select vendor…</option></select></div>
            <div class="field"><label>Qty Available</label><input id="loQty" type="number" placeholder="10000"></div>
            <div class="field"><label>Unit Price ($)</label><input id="loPrice" type="number" step="0.0001" placeholder="0.2500"></div>
            <div class="field"><label>Lead Time</label><input id="loLead" placeholder="4–6 wks"></div>
            <div class="field"><label>Condition</label>
                <select id="loCond" style="padding:8px 10px;border:1px solid var(--border);border-radius:6px;background:var(--input);font-size:12px">
                    <option value="New">New</option><option value="Refurbished">Refurbished</option><option value="Used">Used</option>
                </select>
            </div>
            <div class="field"><label>Date Code</label><input id="loDC" placeholder="2024+"></div>
            <div class="field"><label>Firmware</label><input id="loFirmware" placeholder="v2.1"></div>
            <div class="field"><label>Hardware Rev</label><input id="loHardware" placeholder="Rev C"></div>
            <div class="field"><label>Packaging</label><input id="loPackaging" placeholder="Reel, Tray…"></div>
            <div class="field"><label>MOQ</label><input id="loMoq" type="number" placeholder="1000"></div>
            <div class="field field-full"><label>Notes</label><input id="loNotes" placeholder="Optional notes…"></div>
            <div class="field field-full">
                <label>Attachments</label>
                <div id="loAttachments" style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:6px"></div>
                <div style="display:flex;gap:6px">
                    <label class="btn btn-ghost btn-sm" style="cursor:pointer">
                        Upload File <input type="file" id="loFileInput" multiple accept="image/*,.pdf,.xlsx,.xls,.csv,.doc,.docx" style="display:none" onchange="handleOfferFileSelect(this)">
                    </label>
                    <button class="btn btn-ghost btn-sm" onclick="openOneDrivePicker()">Browse OneDrive</button>
                </div>
            </div>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('logOfferModal')">Cancel</button>
            <button class="btn btn-ghost" onclick="saveOffer(true)">Save &amp; Next</button>
            <button class="btn btn-primary" onclick="saveOffer(false)">Save &amp; Close</button>
        </div>
    </div>
</div>

<!-- Send Quote Modal -->
<div id="sendQuoteModal" class="modal-bg" onclick="if(event.target===this)closeModal('sendQuoteModal')">
    <div class="modal" style="max-width:440px">
        <h3 style="margin-bottom:12px">Send Quote</h3>
        <p id="sqQuoteNum" style="font-size:12px;color:var(--text2);margin-bottom:12px"></p>
        <label style="display:block;margin-bottom:8px;font-size:12px;font-weight:600">Recipient</label>
        <select id="sqContactSelect" onchange="onSqContactChange()" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:8px;font-size:12px;margin-bottom:8px">
        </select>
        <div id="sqManualRow" style="display:none;margin-bottom:8px">
            <label style="display:block;font-size:11px;color:var(--text2);margin-bottom:2px">Email address</label>
            <input id="sqManualEmail" type="email" placeholder="name@company.com" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:8px;font-size:12px">
        </div>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:16px">
            <button class="btn btn-ghost" onclick="closeModal('sendQuoteModal')">Cancel</button>
            <button class="btn btn-primary" onclick="confirmSendQuote()">Send</button>
        </div>
    </div>
</div>

<!-- Edit Offer Modal -->
<div id="editOfferModal" class="modal-bg" onclick="if(event.target===this)closeModal('editOfferModal')">
    <div class="modal modal-lg">
        <h2>Edit Offer</h2>
        <div class="lo-form">
            <input type="hidden" id="eoOfferId">
            <div class="field field-full"><label>Vendor Name</label><input id="eoVendor"></div>
            <div class="field"><label>Qty Available</label><input id="eoQty" type="number"></div>
            <div class="field"><label>Unit Price ($)</label><input id="eoPrice" type="number" step="0.0001"></div>
            <div class="field"><label>Lead Time</label><input id="eoLead"></div>
            <div class="field"><label>Condition</label>
                <select id="eoCond" style="padding:8px 10px;border:1px solid var(--border);border-radius:6px;background:var(--input);font-size:12px">
                    <option value="New">New</option><option value="Refurbished">Refurbished</option><option value="Used">Used</option>
                </select>
            </div>
            <div class="field"><label>Date Code</label><input id="eoDC"></div>
            <div class="field"><label>Firmware</label><input id="eoFirmware"></div>
            <div class="field"><label>Hardware Rev</label><input id="eoHardware"></div>
            <div class="field"><label>Packaging</label><input id="eoPackaging"></div>
            <div class="field"><label>MOQ</label><input id="eoMoq" type="number"></div>
            <div class="field field-full"><label>Notes</label><input id="eoNotes"></div>
            <div class="field"><label>Status</label>
                <select id="eoStatus" style="padding:8px 10px;border:1px solid var(--border);border-radius:6px;background:var(--input);font-size:12px">
                    <option value="active">Active</option><option value="expired">Expired</option><option value="won">Won</option><option value="lost">Lost</option>
                </select>
            </div>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('editOfferModal')">Cancel</button>
            <button class="btn btn-primary" onclick="updateOffer()">Save Changes</button>
        </div>
    </div>
</div>

<!-- OneDrive Browser Modal -->
<div id="oneDriveModal" class="modal-bg" onclick="if(event.target===this)closeModal('oneDriveModal')">
    <div class="modal modal-lg">
        <h2>Browse OneDrive</h2>
        <div id="odBreadcrumb" style="font-size:12px;color:var(--muted);margin-bottom:8px">
            <a onclick="browseOneDrive('')" style="cursor:pointer;color:var(--teal)">Root</a>
        </div>
        <div id="odFileList" style="max-height:400px;overflow-y:auto"><p class="empty">Loading…</p></div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('oneDriveModal')">Close</button>
        </div>
    </div>
</div>

<!-- Buy Plan Modal -->
<div id="buyPlanModal" class="modal-bg" onclick="if(event.target===this)closeModal('buyPlanModal')">
    <div class="modal modal-lg">
        <h2>Mark Won &amp; Submit Buy Plan</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:12px">Select items and set the quantity to purchase from each vendor. This will be sent to management for approval.</p>
        <table class="tbl" style="margin-bottom:12px">
            <thead><tr><th style="width:30px"></th><th>MPN</th><th>Mfr</th><th>Avail Qty</th><th>Plan Qty</th><th>Unit Cost</th><th>Line Total</th><th>Lead</th></tr></thead>
            <tbody id="bpItems"></tbody>
        </table>
        <div style="text-align:right;font-weight:600;margin-bottom:12px">Total Cost: <span id="bpTotal"></span></div>
        <div class="field" style="margin-bottom:12px">
            <label>Notes for Manager &amp; Buyers</label>
            <textarea id="bpSalespersonNotes" rows="3" placeholder="Add any context, special instructions, or notes for the purchasing team..." style="width:100%;padding:8px 10px;border:1px solid var(--border);border-radius:6px;font-size:12px;background:var(--input)"></textarea>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('buyPlanModal')">Cancel</button>
            <button class="btn btn-success" onclick="submitBuyPlan()">Mark Won &amp; Submit Buy Plan</button>
        </div>
    </div>
</div>

<!-- Lost Reason Modal -->
<div id="lostModal" class="modal-bg" onclick="if(event.target===this)closeModal('lostModal')">
    <div class="modal">
        <h2>Mark Quote as Lost</h2>
        <div class="field">
            <label>Reason</label>
            <select id="lostReason" style="padding:8px 10px;border:1px solid var(--border);border-radius:6px;background:var(--input);font-size:12px">
                <option value="">— Select —</option>
                <option value="price">Price too high</option>
                <option value="lead_time">Lead time too long</option>
                <option value="competitor">Lost to competitor</option>
                <option value="no_response">No response</option>
                <option value="cancelled">Customer cancelled</option>
                <option value="other">Other</option>
            </select>
        </div>
        <div class="field"><label>Notes</label><input id="lostNotes" placeholder="Optional details…"></div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('lostModal')">Cancel</button>
            <button class="btn btn-danger" onclick="submitLost()">Mark Lost</button>
        </div>
    </div>
</div>

<!-- Pricing History Modal -->
<div id="phModal" class="modal-bg" onclick="if(event.target===this)closeModal('phModal')">
    <div class="modal modal-lg">
        <h2>Pricing History — <span id="phMpn" style="font-family:'JetBrains Mono',monospace"></span></h2>
        <div id="phContent"><p class="empty">Loading…</p></div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('phModal')">Close</button>
        </div>
    </div>
</div>

<!-- Site Contact Modal -->
<div id="siteContactModal" class="modal-bg" onclick="if(event.target===this)closeModal('siteContactModal')">
    <div class="modal">
        <h2 id="siteContactModalTitle">Add Contact</h2>
        <input type="hidden" id="scSiteId">
        <input type="hidden" id="scContactId">
        <div class="lo-form">
            <div class="field"><label for="scFullName">Name *</label><input id="scFullName" placeholder="Full name" required onkeydown="if(event.key==='Enter')saveSiteContact()"></div>
            <div class="field"><label for="scTitle">Job Title</label><input id="scTitle" placeholder="e.g. Purchasing Manager"></div>
            <div class="field"><label for="scEmail">Email</label><input id="scEmail" type="email" placeholder="email@company.com"></div>
            <div class="field"><label for="scPhone">Phone</label><input id="scPhone" type="tel" placeholder="+1 555-000-0000"></div>
            <div class="field field-full"><label for="scNotes">Notes</label><textarea id="scNotes" rows="2" placeholder="Optional notes"></textarea></div>
        </div>
        <label style="display:flex;align-items:center;gap:8px;margin:8px 0;font-size:12px;color:var(--text2);cursor:pointer"><input id="scPrimary" type="checkbox" style="accent-color:var(--teal)" aria-label="Primary contact"> Primary contact</label>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('siteContactModal')">Cancel</button>
            <button class="btn btn-primary" onclick="saveSiteContact()">Save Contact</button>
        </div>
    </div>
</div>

<!-- Log Call Modal -->
<div id="logCallModal" class="modal-bg" onclick="if(event.target===this)closeModal('logCallModal')">
    <div class="modal">
        <h2>Log Phone Call &mdash; <span id="lcCompanyName"></span></h2>
        <input type="hidden" id="lcCompanyId">
        <div class="lo-form">
            <div class="field"><label for="lcPhone">Phone *</label><input id="lcPhone" type="tel" placeholder="+1 555-000-0000" required onkeydown="if(event.key==='Enter')saveLogCall()"></div>
            <div class="field"><label for="lcContactName">Contact Name</label><input id="lcContactName" placeholder="Who did you speak to?"></div>
            <div class="field"><label for="lcDirection">Direction</label>
                <select id="lcDirection" style="background:var(--input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;font-size:12px;width:100%">
                    <option value="outbound">Outbound</option>
                    <option value="inbound">Inbound</option>
                </select>
            </div>
            <div class="field"><label for="lcDuration">Duration (seconds)</label><input id="lcDuration" type="number" placeholder="120" min="0"></div>
            <div class="field"><label for="lcNotes">Notes</label><textarea id="lcNotes" rows="3" placeholder="Call summary..." style="width:100%;background:var(--input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;font-size:12px;resize:vertical"></textarea></div>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('logCallModal')">Cancel</button>
            <button class="btn btn-primary" onclick="saveLogCall()">Log Call</button>
        </div>
    </div>
</div>

<div id="logNoteModal" class="modal-bg" onclick="if(event.target===this)closeModal('logNoteModal')">
    <div class="modal">
        <h2>Add Note &mdash; <span id="lnCompanyName"></span></h2>
        <input type="hidden" id="lnCompanyId">
        <div class="lo-form">
            <div class="field"><label for="lnContactName">Contact Name (optional)</label><input id="lnContactName" placeholder="Related contact name"></div>
            <div class="field"><label for="lnNotes">Note *</label><textarea id="lnNotes" rows="4" placeholder="Enter note..." required style="width:100%;background:var(--input);border:1px solid var(--border);border-radius:6px;padding:8px 10px;font-size:12px;resize:vertical"></textarea></div>
        </div>
        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('logNoteModal')">Cancel</button>
            <button class="btn btn-primary" onclick="saveLogNote()">Save Note</button>
        </div>
    </div>
</div>

<!-- Compare Offers Modal -->

<!-- Proactive Send Modal -->
<div id="proactiveSendModal" class="modal-bg" onclick="if(event.target===this)closeModal('proactiveSendModal')">
    <div class="modal" style="max-width:680px">
        <h2>Send Proactive Offer</h2>
        <p id="psmCustomer" style="font-size:13px;color:var(--text2);margin-bottom:12px"></p>

        <div style="margin-bottom:12px">
            <label style="font-size:12px;font-weight:600;margin-bottom:4px;display:block">Selected Items</label>
            <table class="offer-table" style="width:100%;font-size:12px">
                <thead><tr><th>MPN</th><th>Vendor</th><th>Qty</th><th>Cost</th><th>Sell Price</th><th>Condition</th></tr></thead>
                <tbody id="psmItems"></tbody>
            </table>
        </div>

        <div class="send-preview" id="psmPreview"></div>

        <div style="margin-top:12px">
            <label style="font-size:12px;font-weight:600;margin-bottom:4px;display:block">Contacts</label>
            <div id="psmContacts" style="font-size:12px"><span class="empty">Loading contacts…</span></div>
        </div>

        <div class="field" style="margin-top:12px">
            <label for="psmSubject">Subject</label>
            <input id="psmSubject" placeholder="Parts Available — Company">
        </div>

        <div class="field" style="margin-top:8px">
            <label for="psmNotes">Notes (optional)</label>
            <textarea id="psmNotes" rows="3" placeholder="Add a personal message…" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:6px;font-size:12px;resize:vertical"></textarea>
        </div>

        <div class="mactions">
            <button class="btn btn-ghost" onclick="closeModal('proactiveSendModal')">Cancel</button>
            <button class="btn btn-primary" id="psmSendBtn" onclick="sendProactiveOffer()">Send Email</button>
        </div>
    </div>
</div>

    <!-- VIEW: Performance Tracking -->
    <div id="view-performance" style="display:none">
        <div class="vendor-header">
            <h2>Scorecards</h2>
        </div>
        <div class="tabs" id="perfTabs">
            <button class="tab on" onclick="switchPerfTab('vendors',this)">Vendor Scorecard</button>
            <button class="tab" onclick="switchPerfTab('buyers',this)">Buyer Leaderboard</button>
            <button class="tab" onclick="switchPerfTab('sales',this)">Salesperson Scorecard</button>
        </div>
        <div id="perfVendorPanel"><p class="empty">Loading...</p></div>
        <div id="perfBuyerPanel" style="display:none"><p class="empty">Loading...</p></div>
        <div id="perfSalesPanel" style="display:none"><p class="empty">Loading...</p></div>
    </div>


    <!-- VIEW: Settings (admin + dev_assistant) -->
    <div id="view-settings" style="display:none">
        <div class="vendor-header">
            <h2>Admin Settings</h2>
        </div>
        <div class="tabs" id="settingsTabs">
            <button class="tab on settings-tab-users" onclick="switchSettingsTab('users',this)">Users</button>
            <button class="tab" onclick="switchSettingsTab('health',this)">System Health</button>
            <button class="tab settings-tab-scoring" onclick="switchSettingsTab('scoring',this)">Scoring Weights</button>
            <button class="tab" onclick="switchSettingsTab('config',this)">Configuration</button>
            <button class="tab" onclick="switchSettingsTab('sources',this)">Data Sources</button>
            <button class="tab settings-tab-users" onclick="switchSettingsTab('create-user',this)">Create User</button>
            <button class="tab" onclick="switchSettingsTab('enrichment',this)">Enrichment</button>
            <button class="tab settings-tab-users" onclick="switchSettingsTab('unmatched',this)">Unmatched Queue</button>
            <button class="tab settings-tab-users" onclick="switchSettingsTab('teams',this)">Teams Integration</button>
        </div>

        <div id="settings-users" class="settings-panel">
            <div id="adminUsersList"><p class="empty">Loading...</p></div>
        </div>

        <div id="settings-health" class="settings-panel" style="display:none">
            <div id="settingsHealthContent"><p class="empty">Loading...</p></div>
        </div>

        <div id="settings-scoring" class="settings-panel" style="display:none">
            <div id="settingsScoringContent"><p class="empty">Loading...</p></div>
        </div>

        <div id="settings-config" class="settings-panel" style="display:none">
            <div id="settingsConfigContent"><p class="empty">Loading...</p></div>
        </div>

        <div id="settings-sources" class="settings-panel" style="display:none">
            <div id="settingsSourcesList"><p class="empty">Loading...</p></div>
        </div>

        <div id="settings-unmatched" class="settings-panel" style="display:none">
            <div id="unmatchedQueueContent"><p class="empty">Loading...</p></div>
        </div>

        <div id="settings-teams" class="settings-panel" style="display:none">
            <div id="teamsConfigContent"><p class="empty">Loading...</p></div>
        </div>

        <div id="settings-enrichment" class="settings-panel" style="display:none">
            <div class="tabs" id="enrichTabs">
                <button class="tab on" onclick="switchEnrichTab('queue',this)">Review Queue</button>
                <button class="tab" onclick="switchEnrichTab('backfill',this)">Backfill</button>
                <button class="tab" onclick="switchEnrichTab('jobs',this)">Job History</button>
                <button class="tab" onclick="switchEnrichTab('m365',this)">Inbox Mining</button>
            </div>

            <!-- Review Queue Tab -->
            <div id="enrichQueuePanel">
                <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center;">
                    <select id="eqStatusFilter" onchange="loadEnrichmentQueue()" style="padding:4px 8px;border-radius:4px;border:1px solid var(--border)">
                        <option value="pending">Pending</option>
                        <option value="auto_applied">Auto-Applied</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                        <option value="all">All</option>
                    </select>
                    <select id="eqEntityFilter" onchange="loadEnrichmentQueue()" style="padding:4px 8px;border-radius:4px;border:1px solid var(--border)">
                        <option value="">All Entities</option>
                        <option value="vendor">Vendors</option>
                        <option value="company">Companies</option>
                    </select>
                    <button class="btn btn-sm" onclick="bulkApproveSelected()" id="eqBulkApproveBtn" style="display:none">Approve Selected</button>
                    <span id="eqCount" style="color:var(--muted);font-size:13px;margin-left:auto;"></span>
                </div>
                <div id="enrichQueueList"><p class="empty">Loading...</p></div>
            </div>

            <!-- Backfill Tab -->
            <div id="enrichBackfillPanel" style="display:none">
                <div class="card" style="max-width:600px;margin-bottom:16px;padding:16px;">
                    <h3 style="margin-top:0;">Start Deep Enrichment</h3>
                    <label style="display:block;margin-bottom:8px;">
                        <input type="checkbox" id="bfVendors" checked> Vendors
                    </label>
                    <label style="display:block;margin-bottom:8px;">
                        <input type="checkbox" id="bfCompanies" checked> Companies
                    </label>
                    <label style="display:block;margin-bottom:8px;">
                        <input type="checkbox" id="bfDeepEmail"> Include Deep Email Mining
                    </label>
                    <label style="display:block;margin-bottom:8px;">
                        Max items: <input type="number" id="bfMaxItems" value="500" min="1" max="2000" style="width:80px;padding:2px 6px;">
                    </label>
                    <button class="btn" onclick="startBackfill()">Start Enrichment</button>
                    <span id="bfStatus" style="margin-left:12px;"></span>
                </div>
                <div id="bfProgressBox" style="display:none;max-width:600px;">
                    <h4>Running Job</h4>
                    <div style="background:var(--bg);border-radius:4px;height:20px;overflow:hidden;margin-bottom:8px;">
                        <div id="bfProgressBar" style="height:100%;background:var(--teal);transition:width 0.3s;width:0%"></div>
                    </div>
                    <span id="bfProgressLabel" style="font-size:13px;color:var(--muted);"></span>
                </div>

                <!-- Backfill from Existing Data -->
                <div class="card" style="max-width:600px;margin-bottom:16px;padding:16px;">
                    <h3 style="margin-top:0;">Backfill from Existing Data</h3>
                    <p style="color:var(--muted);font-size:13px;margin-bottom:12px;">Recover vendor emails already in the system — activity logs, vendor card imports, and BrokerBin sightings.</p>
                    <button class="btn" onclick="startEmailBackfill()">Backfill Emails</button>
                    <span id="emailBfStatus" style="margin-left:12px;"></span>
                </div>

                <!-- Scrape Vendor Websites -->
                <div class="card" style="max-width:600px;margin-bottom:16px;padding:16px;">
                    <h3 style="margin-top:0;">Scrape Vendor Websites</h3>
                    <p style="color:var(--muted);font-size:13px;margin-bottom:12px;">Scrape contact pages of vendors with websites but few email contacts.</p>
                    <label style="display:block;margin-bottom:8px;">
                        Max vendors: <input type="number" id="scrapeMaxVendors" value="500" min="1" max="2000" style="width:80px;padding:2px 6px;">
                    </label>
                    <button class="btn" onclick="startWebsiteScrape()">Scrape Websites</button>
                    <span id="scrapeStatus" style="margin-left:12px;"></span>
                </div>
            </div>

            <!-- Job History Tab -->
            <div id="enrichJobsPanel" style="display:none">
                <div id="enrichJobsList"><p class="empty">Loading...</p></div>
            </div>

            <!-- M365 Connection Status -->
            <div id="enrichM365Panel" style="display:none">
                <div class="card" style="max-width:700px;padding:16px;">
                    <h3 style="margin-top:0;">M365 Inbox Mining</h3>
                    <p style="color:var(--muted);font-size:13px;margin-bottom:12px;">Users must authenticate via Azure AD to enable inbox mining for vendor email extraction.</p>
                    <div id="m365UserList"><p class="empty">Loading...</p></div>
                </div>
            </div>

            <!-- Stats Summary -->
            <div id="enrichStatsPanel" style="margin-top:16px;padding:12px;background:var(--bg);border-radius:6px;display:flex;gap:24px;flex-wrap:wrap;">
                <div><strong id="esVendors">-</strong><br><small style="color:var(--muted)">Vendors Enriched</small></div>
                <div><strong id="esCompanies">-</strong><br><small style="color:var(--muted)">Companies Enriched</small></div>
                <div><strong id="esPending">-</strong><br><small style="color:var(--muted)">Pending Review</small></div>
                <div><strong id="esAutoApplied">-</strong><br><small style="color:var(--muted)">Auto-Applied</small></div>
                <div><strong id="esActiveJobs">-</strong><br><small style="color:var(--muted)">Active Jobs</small></div>
                <div><strong id="esVendorEmails">-</strong><br><small style="color:var(--muted)">Vendor Emails</small></div>
            </div>
        </div>

        <div id="settings-create-user" class="settings-panel" style="display:none">
            <div class="card" style="max-width:500px;padding:20px">
                <h3 style="margin:0 0 16px;font-size:15px">Create New User</h3>
                <div style="display:flex;flex-direction:column;gap:10px">
                    <input id="newUserName" placeholder="Full name" style="padding:8px 12px;border:1px solid var(--border);border-radius:6px;background:var(--surface);color:var(--text)">
                    <input id="newUserEmail" placeholder="Email address" type="email" style="padding:8px 12px;border:1px solid var(--border);border-radius:6px;background:var(--surface);color:var(--text)">
                    <select id="newUserRole" style="padding:8px 12px;border:1px solid var(--border);border-radius:6px;background:var(--surface);color:var(--text)">
                        <option value="buyer">Buyer</option>
                        <option value="trader">Trader</option>
                        <option value="sales">Sales</option>
                        <option value="manager">Manager</option>
                        <option value="admin">Admin</option>
                        <option value="dev_assistant">Dev Assistant</option>
                    </select>
                    <button class="btn btn-primary" onclick="createUser()">Create User</button>
                </div>
            </div>
        </div>

    </div><!-- end view-settings -->
    </div><!-- end main-scroll -->
</div><!-- end main -->

<script>
window.__userName = "{{ user_name }}";
window.__userEmail = "{{ user_email }}";
window.__isAdmin = {{ "true" if is_admin else "false" }};
window.__isDevAssistant = {{ "true" if is_dev_assistant else "false" }};
/* Inline stubs — overridden by app.js with full implementations */
function setNav(btn) {}
function toggleMobileSidebar() {
    var sb = document.getElementById('sidebar');
    var ov = document.getElementById('sidebarOverlay');
    if (sb) sb.classList.toggle('mobile-open');
    if (ov) ov.classList.toggle('open');
}
/* Close filter panel on outside click */
document.addEventListener('click', function(e) {
    document.querySelectorAll('.filter-panel.open').forEach(function(p) {
        if (!p.closest('.filter-wrap').contains(e.target)) p.classList.remove('open');
    });
});
</script>
<script defer src="/static/app.js?v={{ app_version }}"></script>
<script defer src="/static/crm.js?v={{ app_version }}"></script>
{% endif %}
</body>
</html>
